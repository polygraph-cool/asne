!function(t){function e(r){if(a[r])return a[r].exports;var n=a[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var a={};e.m=t,e.c=a,e.i=function(t){return t},e.d=function(t,a,r){e.o(t,a)||Object.defineProperty(t,a,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var a=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(a,"a",a),a},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=6)}([function(t,e){!function(){"use strict";function t(t){d.push(t),1==d.length&&c()}function e(){for(;d.length;)d[0](),d.shift()}function a(t){this.a=p,this.b=void 0,this.f=[];var e=this;try{t(function(t){o(e,t)},function(t){s(e,t)})}catch(t){s(e,t)}}function r(t){return new a(function(e,a){a(t)})}function n(t){return new a(function(e){e(t)})}function o(t,e){if(t.a==p){if(e==t)throw new TypeError;var a=!1;try{var r=e&&e.then;if(null!=e&&"object"==typeof e&&"function"==typeof r)return void r.call(e,function(e){a||o(t,e),a=!0},function(e){a||s(t,e),a=!0})}catch(e){return void(a||s(t,e))}t.a=0,t.b=e,i(t)}}function s(t,e){if(t.a==p){if(e==t)throw new TypeError;t.a=1,t.b=e,i(t)}}function i(e){t(function(){if(e.a!=p)for(;e.f.length;){var t=e.f.shift(),a=t[0],r=t[1],n=t[2],t=t[3];try{0==e.a?n("function"==typeof a?a.call(void 0,e.b):e.b):1==e.a&&("function"==typeof r?n(r.call(void 0,e.b)):t(e.b))}catch(e){t(e)}}})}function l(t){return new a(function(e,a){var r=0,o=[];0==t.length&&e(o);for(var s=0;s<t.length;s+=1)n(t[s]).c(function(a){return function(n){o[a]=n,(r+=1)==t.length&&e(o)}}(s),a)})}function u(t){return new a(function(e,a){for(var r=0;r<t.length;r+=1)n(t[r]).c(e,a)})}var c,d=[];c=function(){setTimeout(e)};var p=2;a.prototype.g=function(t){return this.c(void 0,t)},a.prototype.c=function(t,e){var r=this;return new a(function(a,n){r.f.push([t,e,a,n]),i(r)})},window.Promise||(window.Promise=a,window.Promise.resolve=n,window.Promise.reject=r,window.Promise.race=u,window.Promise.all=l,window.Promise.prototype.then=a.prototype.c,window.Promise.prototype.catch=a.prototype.g)}()},function(t,e,a){"use strict";function r(t){return null!==t&&"object"==typeof t}t.exports=r},function(t,e,a){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function n(){return new Promise(function(t,e){d3.queue().defer(d3.csv,"assets/map_data_3.csv").defer(d3.csv,"assets/lats_2.csv").defer(d3.csv,"assets/newsidsunique_4.csv").defer(d3.json,"assets/usJson.json").defer(d3.csv,"assets/census_3.csv").defer(d3.csv,"assets/census_override_3.csv").defer(d3.csv,"assets/new_2018_3.csv").awaitAll(function(t,a){t?e(t):c.default.init(a[0],a[1],a[2],a[3],a[4],a[5],a[6])})})}Object.defineProperty(e,"__esModule",{value:!0});Object.assign;a(0);var o=a(7),s=(r(o),a(8)),i=(r(s),a(14)),l=(r(i),a(11)),u=(r(l),a(13)),c=r(u),d=a(10),p=(r(d),a(5)),f=(r(p),a(12)),h=(r(f),a(9));r(h);e.default={init:n}},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r={android:function(){return navigator.userAgent.match(/Android/i)},blackberry:function(){return navigator.userAgent.match(/BlackBerry/i)},ios:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},opera:function(){return navigator.userAgent.match(/Opera Mini/i)},windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return r.android()||r.blackberry()||r.ios()||r.opera()||r.windows()}};e.default=r},function(t,e,a){(function(e){function a(t,e,a){function n(e){var a=m,r=v;return m=v=void 0,k=e,y=t.apply(r,a)}function o(t){return k=t,w=setTimeout(c,e),N?n(t):y}function l(t){var a=t-b,r=t-k,n=e-a;return S?M(n,g-r):n}function u(t){var a=t-b,r=t-k;return void 0===b||a>=e||a<0||S&&r>=g}function c(){var t=_();if(u(t))return d(t);w=setTimeout(c,l(t))}function d(t){return w=void 0,A&&m?n(t):(m=v=void 0,y)}function p(){void 0!==w&&clearTimeout(w),k=0,m=b=v=w=void 0}function f(){return void 0===w?y:d(_())}function h(){var t=_(),a=u(t);if(m=arguments,v=this,b=t,a){if(void 0===w)return o(b);if(S)return w=setTimeout(c,e),n(b)}return void 0===w&&(w=setTimeout(c,e)),y}var m,v,g,y,w,b,k=0,N=!1,S=!1,A=!0;if("function"!=typeof t)throw new TypeError(i);return e=s(e)||0,r(a)&&(N=!!a.leading,S="maxWait"in a,g=S?x(s(a.maxWait)||0,e):g,A="trailing"in a?!!a.trailing:A),h.cancel=p,h.flush=f,h}function r(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function n(t){return!!t&&"object"==typeof t}function o(t){return"symbol"==typeof t||n(t)&&w.call(t)==u}function s(t){if("number"==typeof t)return t;if(o(t))return l;if(r(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=r(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(c,"");var a=p.test(t);return a||f.test(t)?h(t.slice(2),a?2:8):d.test(t)?l:+t}var i="Expected a function",l=NaN,u="[object Symbol]",c=/^\s+|\s+$/g,d=/^[-+]0x[0-9a-f]+$/i,p=/^0b[01]+$/i,f=/^0o[0-7]+$/i,h=parseInt,m="object"==typeof e&&e&&e.Object===Object&&e,v="object"==typeof self&&self&&self.Object===Object&&self,g=m||v||Function("return this")(),y=Object.prototype,w=y.toString,x=Math.max,M=Math.min,_=function(){return g.Date.now()};t.exports=a}).call(e,a(24))},function(t,e,a){"use strict";function r(t,e,a,r){function o(t){return"gender"==l?+(t.total_num-t.male_num)/t.total_num:"supWhite"==l?+t.white_sup_num/t.total_sup_num:"supGender"==l?+t.male_sup_num/t.total_sup_num:(+t.total_num-+t.white_num)/t.total_num}function s(t,e){return"gender"==t?+(e.total_num-e.male_num)/e.total_num:"supWhite"==t?+e.white_sup_num/e.total_sup_num:"supGender"==t?(+e.total_sup_num-+e.male_sup_num)/e.total_sup_num:(+e.total_num-+e.white_num)/e.total_num}function i(){function e(t,e){return e>t?"M0,"+(e-2)+" L4,"+(e-8)+" L1.5,"+(e-8)+" L0,"+t+" L-1.5,"+(e-8)+" L-4,"+(e-8)+" Z":"M0,"+(e+2)+" L4,"+(e+8)+" L1.5,"+(e+8)+" L0,"+t+" L-1.5,"+(e+8)+" L-4,"+(e+8)+" Z"}function a(t,e){return"M0,"+(e-4)+" L4,"+(e-8)+" L0,"+(e-12)+" L-4,"+(e-8)+" Z"}d3.selectAll(".arrow-scatter-chart-wrapper").remove();var r=h.append("div").attr("class","arrow-scatter-chart-wrapper").style("width",p+d.left+d.right+"px").style("height",f+d.top+d.bottom+"px"),n=r.append("svg").attr("class","arrow-scatter-chart-wrapper-svg-double-change").attr("width",p+d.left+d.right).attr("height",f+d.top+d.bottom),i=r.append("div").attr("class","arrow-scatter-chart-wrapper-text-div").style("transform","translate("+d.left+"px,"+d.top+"px)").style("width",p+d.left+d.right+"px").style("height",f+d.top+d.bottom+"px"),m=h.append("div").attr("class","slope-mini-multiple-div"),v=t.filter(function(t){return"supWhite"==l||"supGender"==l?t.total_num>u&&t.total_sup_num>0:"gender"==l?t.total_num>u&&+t.Year>2e3:t.total_num>u}),g=[],y=[],w=[],x=d3.nest().key(function(t){return+t.NewsID}).rollup(function(t){var e=d3.map(t,function(t){return t.Year}),a=d3.max(t,function(t){return t.total_num}),r=d3.max(t,function(t){return o(t)});return g.push(r),{yearMap:e,values:t,maxTotal:a}}).entries(v);x=x.filter(function(t){return t.value.yearMap.has(2014)&&t.value.values.length>1?t:null});var M=d3.mean(x,function(t){return o(t.value.values[0])}),_=d3.mean(x,function(t){return o(t.value.yearMap.get(2014))});for(var b in x){var k=o(x[b].value.yearMap.get(2014))-o(x[b].value.values[0]);l="supGender";var N=o(x[b].value.yearMap.get(2014))-o(x[b].value.values[0]);l="gender",y.push(k),w.push(N),x[b].value.diff=k,x[b].value.raceDiff=N}x=x.sort(function(t,e){return e.value.diff-t.value.diff});var S=d3.extent(x,function(t){return+t.value.maxTotal}),A=(d3.scaleLinear().domain(S).range([5,30]),d3.extent(g,function(t){return t}),d3.extent(y,function(t){return t})),D=d3.extent(w,function(t){return t}),C=(d3.scaleLinear().domain([A[0],A[1]]).range([0,p]),d3.scaleLinear().domain([D[0],D[1]]).range([f,0]),d3.scaleLinear().domain(S).range([f,0]),d3.scaleLinear().domain(S).range([0,p]),d3.scaleLinear().domain([A[0],0,A[1]]).range(["red","white","green"]),d3.scaleLinear().domain([A[0],0,A[1]]).range(["red","grey","green"]),d3.scaleLinear().domain([0,.7]).range([0,p]),d3.scaleLinear().domain([.25,.5]).range([f,0])),L=n.append("defs").append("linearGradient").attr("id","gradient").attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",1),W=n.append("defs").append("linearGradient").attr("id","gradient-average").attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",1),T=n.append("defs").append("linearGradient").attr("id","gradient-up").attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",1),I=n.append("g").attr("transform","translate("+d.left+","+d.top+")");T.append("stop").attr("stop-color","blue").attr("stop-opacity",1),T.append("stop").attr("offset","100%").attr("stop-color","blue").attr("stop-opacity",.3),W.append("stop").attr("stop-color","black").attr("stop-opacity",1),W.append("stop").attr("offset","100%").attr("stop-color","black").attr("stop-opacity",.3),L.append("stop").attr("stop-color","red").attr("stop-opacity",.3),L.append("stop").attr("offset","100%").attr("stop-color","red").attr("stop-opacity",1),I.append("marker").attr("id","triangle-up").attr("viewBox","0 0 10 10").attr("refX",0).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",6).attr("markerHeight",8).attr("orient","auto").append("path").attr("fill","blue").attr("d","M 0 0 L 10 5 L 0 10 z"),I.append("marker").attr("id","triangle-down").attr("viewBox","0 0 10 10").attr("refX",0).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",6).attr("markerHeight",8).attr("orient","auto").append("path").attr("fill","red").attr("d","M 0 0 L 10 5 L 0 10 z");var O=d3.scaleLinear().domain([0,x.length-1]).range([0,p]),E=I.selectAll("g").data(x).enter().append("g").attr("transform",function(t,e){return"translate("+O(e)+",0)"}).on("mouseover",function(t){c.get(t.value.values[0].NewsID).Company;console.log(t.value.diff),console.log(s("gender",t.value.yearMap.get(2014)),s("gender",t.value.values[0]))});I.append("g").attr("transform",function(t,e){return"translate("+O((x.length-1)/2)+",0)"}).append("path").attr("class","arrow-scatter-line arrow-scatter-line-average").attr("d",function(t){return e(C(M),C(_))}).attr("fill",function(t){return _-M>0?"url(#gradient-average)":"url(#gradient)"}).attr("stroke","none").attr("fill-opacity",1);E.append("path").attr("class","arrow-scatter-line").attr("d",function(t){var r=C(s("gender",t.value.values[0])),n=C(s("gender",t.value.yearMap.get(2014)));return Math.abs(t.value.diff)<.008?a(r,n):e(r,n)}).attr("fill",function(t){return t.value.diff>0?"url(#gradient-up)":Math.abs(t.value.diff)<.015?"#888888":"url(#gradient)"}).attr("stroke","none").attr("fill-opacity",1),E.append("text").attr("class","arrow-scatter-line-text").attr("transform",function(t,e){return"rotate(-90 "+C(s("gender",t.value.values[0]))/2+" "+C(s("gender",t.value.values[0]))/2+")"}).text(function(t){var e=c.get(t.value.values[0].NewsID).Company;return"the new york times"==e?e:null}),i.selectAll("div").data(x).enter().append("div").attr("class","arrow-scatter-line-text-div").style("transform",function(t,e){return"translate("+O(e)+"px,"+C(s("gender",t.value.yearMap.get(2014)))+"px)"}).append("div").attr("class","arrow-scatter-line-logo").style("background-image",function(t){if("the new york times"==c.get(t.value.values[0].NewsID).Company)return"url(assets/ny-times-logo.svg)"});i.append("div").attr("class","arrow-scatter-line-text-div").style("transform",function(t,e){return"translate("+O((x.length-1)/2)+"px,"+C(_)+"px)"}).append("div").attr("class","arrow-scatter-line-text-average").text(function(t){return"Overall"}),i.append("div").attr("class","arrow-scatter-line-text-div").style("transform",function(t,e){return"translate("+O((x.length-1)/2)+"px,"+C(_)+"px)"}).append("div").attr("class","arrow-scatter-line-text-average arrow-scatter-line-text-average-num-top").text(function(t){return Math.floor(100*_)+"%"}),i.append("div").attr("class","arrow-scatter-line-text-div").style("transform",function(t,e){return"translate("+O((x.length-1)/2)+"px,"+C(M)+"px)"}).append("div").attr("class","arrow-scatter-line-text-average arrow-scatter-line-text-average-num-bottom").text(function(t){return Math.floor(100*M)+"%"});var R=I.append("g").selectAll("g").data([.3,.4,.5]).enter().append("g");R.append("text").attr("x",function(t){return-12}).attr("y",function(t){return C(t)+2}).attr("dominant-baseline","middle").attr("class","arrow-scatter-axis-text").text(function(t){return.5==t?"50/50 Gender Split":Math.floor(100*(1-t))+"% Male"}).style("fill",function(t){return.5==t?"rgb(136, 136, 136)":null}),R.append("line").attr("class","arrow-scatter-line-axis").attr("x1",function(t){return 0}).attr("x2",function(t){return p}).attr("y1",function(t){return C(t)}).attr("y2",function(t){return C(t)}).style("stroke-width",function(t){return.5==t?"2px":null}).style("stroke",function(t){return.5!=t?"#a7a7a7":null}).style("stroke-dasharray",function(t){return.5!=t?"3,1":null});var P={top:0,right:10,bottom:0,left:10},j=50-P.left-P.right,G=80-P.top-P.bottom,H=(d3.scaleLinear().domain([.2,.5,.8]).range(["#2161fa","#dddddd","#ff3333"]),d3.scaleLinear().domain([.2,.5]).range([G,0])),Y=m.append("div").attr("class","mini-multiple-div-container").selectAll("div").data(x.sort(function(t,e){return+e.value.maxTotal-+t.value.maxTotal}).slice(0,25)).enter().append("div").attr("class","mini-multiple-div");Y.append("div").attr("class","mini-multiple-text-container").append("p").attr("class","mini-multiple-text").style("margin-top",20).text(function(t){var e=c.get(t.value.values[0].NewsID).Company.replace("the","");return e.length>20?e.slice(0,17)+"...":e});var F=Y.append("svg").attr("class","slope-mini-svg").attr("width",j+P.left+P.right).attr("height",G+P.top+P.bottom),U=F.append("g").style("transform","translate("+P.left+"px,"+P.top+"px)"),K=U.append("g").attr("class","slope-line-axis-container");U.append("circle").attr("cx",function(t){return 0}).attr("cy",function(t){return H(s("gender",t.value.values[0]))}).attr("r",3).attr("class","slope-small-dot").style("fill",function(t){return t.value.diff>0?"blue":"red"}),U.append("text").attr("x",function(t){return 0}).attr("y",function(t,e){return 0==e?H(s("gender",t.value.values[0]))+27:H(s("gender",t.value.values[0]))+15}).attr("class","slope-small-text").text(function(t,e){return 0==e?Math.floor(100*s("gender",t.value.values[0]))+"%":Math.floor(100*s("gender",t.value.values[0]))}),U.append("text").attr("x",function(t){return 0}).attr("y",function(t,e){return 0==e?H(s("gender",t.value.values[0]))+15:null}).attr("class","slope-small-text slope-small-text-bold").text(function(t,e){return 0==e?"2001":null}),U.append("text").attr("x",function(t){return j}).attr("y",function(t,e){return 0==e?H(s("gender",t.value.yearMap.get(2014)))+15:null}).attr("class","slope-small-text slope-small-text-bold").text(function(t,e){return 0==e?"2016":null}).style("text-anchor",function(t,e){return 0==e?"start":null}),U.append("text").attr("x",function(t){return j}).attr("y",function(t,e){return 0==e?H(s("gender",t.value.yearMap.get(2014)))+27:H(s("gender",t.value.yearMap.get(2014)))+15}).attr("class","slope-small-text").text(function(t,e){return 0==e?Math.floor(100*s("gender",t.value.yearMap.get(2014)))+"%":Math.floor(100*s("gender",t.value.yearMap.get(2014)))}).style("text-anchor",function(t,e){return 0==e?"start":null}),U.append("circle").attr("cx",function(t){return j}).attr("cy",function(t){return H(s("gender",t.value.yearMap.get(2014)))}).attr("r",3).attr("class","slope-small-dot").style("fill",function(t){return t.value.diff>0?"blue":"red"}),U.append("line").attr("class","slope-line").attr("y1",function(t){return H(s("gender",t.value.values[0]))}).attr("x1",function(t){return 0}).attr("y2",function(t){return H(s("gender",t.value.yearMap.get(2014)))}).attr("x2",function(t){return j}).attr("stroke-linecap","round").attr("stroke-linejoin","round").attr("stroke-width",1.8).style("stroke",function(t){return t.value.diff>0?"blue":"red"}),K.selectAll("line").data([.2,.3,.4,.5]).enter().append("line").attr("class","slope-line-axis").attr("y1",function(t,e){return H(t)}).attr("x1",function(t){return 0}).attr("y2",function(t,e){return H(t)}).attr("x2",function(t){return j}).style("stroke",function(t){if(.5==t)return"black"})}var l="gender",u=50,c=(d3.map(e,function(t){return t.NewsID}),d3.map(a,function(t){return t.NewsID}),d3.map(r,function(t){return t.NewsID})),d=(d3.map(n,function(t){return t[1]}),{top:40,right:40,bottom:40,left:40}),p=600-d.left-d.right,f=400-d.top-d.bottom,h=(d3.scaleLinear().domain([0,1]).range([0,p]),d3.select(".arrow-scatter"));!function(){var t=h.append("div").attr("class","histogram-chart-toggle-wrapper"),e=[0,20,50,100,500];t.append("div").attr("class","histogram-chart-toggle-size").selectAll("p").data(e).enter().append("p").attr("class",function(t,a){return 0==a?"toggle-selected front-curve histogram-chart-toggle-item":a==e.length-1?"back-curve histogram-chart-toggle-item":"histogram-chart-toggle-item"}).text(function(t){return t}).on("click",function(t){var e=t;d3.select(this.parentNode).selectAll("p").classed("toggle-selected",function(t){return t==e}),u=t,i()});var a=["gender","race"];t.append("div").attr("class","histogram-chart-toggle-type").selectAll("p").data(a).enter().append("p").attr("class",function(t,e){return 0==e?"toggle-selected front-curve histogram-chart-toggle-item":e==a.length-1?"back-curve histogram-chart-toggle-item":"histogram-chart-toggle-item"}).text(function(t){return"race"==t?"Race":"Gender"}).on("click",function(t){var e=t;d3.select(this.parentNode).selectAll("p").classed("toggle-selected",function(t){return t==e}),l=t,i()});var r=["all","leader"];t.append("div").attr("class","histogram-chart-toggle-type").selectAll("p").data(r).enter().append("p").attr("class",function(t,e){return 0==e?"toggle-selected front-curve histogram-chart-toggle-item":e==r.length-1?"back-curve histogram-chart-toggle-item":"histogram-chart-toggle-item"}).text(function(t){return"all"==t?"All Staff":"Leadership"}).on("click",function(t){var e=t;d3.select(this.parentNode).selectAll("p").classed("toggle-selected",function(t){return t==e}),group=t,i()})}(),i()}Object.defineProperty(e,"__esModule",{value:!0});var n=[["Maine","ME",1,"Northeast",23],["Vermont","VT",2,"Northeast",50],["New Hampshire","NH",3,"Northeast",33],["Rhode Island","RI",4,"Northeast",44],["Massachusetts","MA",5,"Northeast",25],["Connecticut","CT",6,"Northeast",9],["Delaware","DE",7,"Northeast",10],["New Jersey","NJ",8,"Northeast",34],["New York","NY",9,"Northeast",36],["Pennsylvania","PA",10,"Northeast",42],["District of Columbia","DC",11,"Northeast",11],["Maryland","MD",12,"Northeast",24],["Virginia","VA",13,"South",51],["North Carolina","NC",14,"South",37],["South Carolina","SC",15,"South",45],["Georgia","GA",16,"South",13],["Alabama","AL",17,"South",1],["Mississippi","MS",18,"South",28],["Louisiana","LA",19,"South",22],["Arkansas","AR",20,"South",5],["Tennessee","TN",21,"South",47],["Kentucky","KY",22,"South",21],["West Virginia","WV",23,"South",54],["Oklahoma","OK",24,"Midwest",40],["Colorado","CO",25,"West",8],["Utah","UT",26,"West",49],["Idaho","ID",27,"West",16],["Wyoming","WY",28,"West",56],["Montana","MT",29,"West",30],["North Dakota","ND",30,"Midwest",38],["South Dakota","SD",31,"Midwest",46],["Nebraska","NE",32,"Midwest",31],["Kansas","KS",33,"Midwest",20],["Iowa","IA",34,"Midwest",19],["Minnesota","MN",35,"Midwest",27],["Wisconsin","WI",36,"Midwest",55],["Indiana","IN",37,"Midwest",18],["Missouri","MO",38,"Midwest",29],["Ohio","OH",39,"Midwest",39],["Michigan","MI",40,"Midwest",26],["Illinois","IL",41,"Midwest",17],["Florida","FL",42,"South",12],["California","CA",43,"West",6],["Nevada","NV",44,"West",32],["Texas","TX",45,"South",48],["Arizona","AZ",46,"West",4],["New Mexico","NM",47,"West",35],["Alaska","AK",48,"West",2],["Washington","WA",49,"West",53],["Oregon","OR",50,"West",41],["Hawaii","HI",51,"West",15]];e.default={init:r}},function(t,e,a){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}var n=a(4),o=(r(n),a(3)),s=r(o),i=a(2),l=r(i),u=d3.select("body");!function(){u.classed("is-mobile",s.default.any()),l.default.init()}()},function(t,e,a){"use strict";function r(t,e,a){function r(t){return"gender"==s?d3.mean(t,function(t){return+t.male_num/t.total_num}):"supWhite"==s?d3.mean(t,function(t){return+t.white_sup_num/t.total_sup_num}):"supGender"==s?d3.mean(t,function(t){return+t.male_sup_num/t.total_sup_num}):d3.mean(t,function(t){return+t.white_num/t.total_num})}function o(t){return"gender"==s?+t.male_num/t.total_num:"supWhite"==s?+t.white_sup_num/t.total_sup_num:"supGender"==s?+t.male_sup_num/t.total_sup_num:+t.white_num/t.total_num}var s="gender",i=(d3.map(e,function(t){return t.NewsID}),d3.map(a,function(t){return t.NewsID})),l=d3.map(n,function(t){return t[1]}),u=d3.scaleLinear().domain([0,1]).range([0,500]),c=d3.select(".line-scatter"),d=d3.nest().key(function(t){var e=null,a=null;return i.has(t.NewsID)&&(e=i.get(t.NewsID).State),l.has(e)&&(a=l.get(e)[3]),a}).key(function(t){return+t.Year}).sortKeys(function(t,e){return t-e}).rollup(function(t){return{average:r(t),values:t}}).entries(t),p=c.selectAll("div").data(d).enter().append("div").attr("class","year-container");p.append("p").text(function(t){return t.key});var f=p.selectAll("div").data(function(t){return t.values}).enter().append("div").attr("class","region-container");f.selectAll("div").data(function(t){return t.value.values}).enter().append("div").attr("class","line").style("left",function(t){var e=o(t);return u(e)+"px"}).style("background-color",function(t){return null}),f.append("div").style("left",function(t){return u(.5)+"px"}).attr("class","line line-half"),f.append("div").datum(function(t){return t.value.average}).style("left",function(t){return u(t)+"px"}).attr("class","line line-average").append("p").text(function(t){return Math.round(100*t)+"%"}),f.append("p").text(function(t){return t.key})}Object.defineProperty(e,"__esModule",{value:!0});var n=[["Maine","ME",1,"Northeast",23],["Vermont","VT",2,"Northeast",50],["New Hampshire","NH",3,"Northeast",33],["Rhode Island","RI",4,"Northeast",44],["Massachusetts","MA",5,"Northeast",25],["Connecticut","CT",6,"Northeast",9],["Delaware","DE",7,"Northeast",10],["New Jersey","NJ",8,"Northeast",34],["New York","NY",9,"Northeast",36],["Pennsylvania","PA",10,"Northeast",42],["District of Columbia","DC",11,"Northeast",11],["Maryland","MD",12,"Northeast",24],["Virginia","VA",13,"South",51],["North Carolina","NC",14,"South",37],["South Carolina","SC",15,"South",45],["Georgia","GA",16,"South",13],["Alabama","AL",17,"South",1],["Mississippi","MS",18,"South",28],["Louisiana","LA",19,"South",22],["Arkansas","AR",20,"South",5],["Tennessee","TN",21,"South",47],["Kentucky","KY",22,"South",21],["West Virginia","WV",23,"South",54],["Oklahoma","OK",24,"Midwest",40],["Colorado","CO",25,"West",8],["Utah","UT",26,"West",49],["Idaho","ID",27,"West",16],["Wyoming","WY",28,"West",56],["Montana","MT",29,"West",30],["North Dakota","ND",30,"Midwest",38],["South Dakota","SD",31,"Midwest",46],["Nebraska","NE",32,"Midwest",31],["Kansas","KS",33,"Midwest",20],["Iowa","IA",34,"Midwest",19],["Minnesota","MN",35,"Midwest",27],["Wisconsin","WI",36,"Midwest",55],["Indiana","IN",37,"Midwest",18],["Missouri","MO",38,"Midwest",29],["Ohio","OH",39,"Midwest",39],["Michigan","MI",40,"Midwest",26],["Illinois","IL",41,"Midwest",17],["Florida","FL",42,"South",12],["California","CA",43,"West",6],["Nevada","NV",44,"West",32],["Texas","TX",45,"South",48],["Arizona","AZ",46,"West",4],["New Mexico","NM",47,"West",35],["Alaska","AK",48,"West",2],["Washington","WA",49,"West",53],["Oregon","OR",50,"West",41],["Hawaii","HI",51,"West",15]];e.default={init:r}},function(t,e,a){"use strict";function r(t,e,a,r){function o(t){return"gender"==l?d3.mean(t,function(t){return+t.male_num/t.total_num}):"supWhite"==l?d3.mean(t,function(t){return+t.white_sup_num/t.total_sup_num}):"supGender"==l?d3.mean(t,function(t){return+t.male_sup_num/t.total_sup_num}):d3.mean(t,function(t){return+t.white_num/t.total_num})}function s(t){return"gender"==l?+t.male_num/t.total_num:"supWhite"==l?+t.white_sup_num/t.total_sup_num:"supGender"==l?+t.male_sup_num/t.total_sup_num:+t.white_num/t.total_num}function i(){var e=t.filter(function(t){return"supWhite"==l||"supGender"==l?t.total_num>u&&t.total_sup_num>0:t.total_num>u});d3.selectAll(".histogram-chart-wrapper").remove();var a=h.append("div").attr("class","histogram-chart-wrapper"),r=d3.nest().key(function(t){return+t.Year}).rollup(function(t){return{average:o(t),values:t}}).entries(e),n=r.filter(function(t){return 2014==t.key})[0].value;n.values=d3.nest().key(function(t){return Math.round(50*s(t))/50}).sortKeys(function(t,e){return t-e}).entries(n.values),a.append("div").attr("class","histogram-avg-div").style("left",function(t){return n.average*f+1+"px"}).append("p").text(Math.round(100*n.average)+"%");var i=a.selectAll(".histogram-year-container").data(n.values).enter().append("div").attr("class","histogram-year-container").style("left",function(t){return t.key*f+1+"px"});i.selectAll("div").data(function(t){return t.values}).enter().append("div").attr("class",function(t){var e=null,a=null;return c.has(t.NewsID)&&(e=c.get(t.NewsID).State),p.has(e)&&(a=p.get(e)[3]),"West"==a&&(a="green"),"South"==a&&(a="blue"),"Midwest"==a&&(a="purple"),"Northeast"==a&&(a="yellow"),"histogram-year-item "+a}).style("background-color",function(t){return null}).on("mouseover",function(t){console.log(d.get(t.NewsID).Company)}),i.append("p").text(function(t,e){return e%5==0||0==e||e==i.size()-1?Math.round(100*t.key)+"%":null})}var l="gender",u=50,c=(d3.map(e,function(t){return t.NewsID}),d3.map(a,function(t){return t.NewsID})),d=d3.map(r,function(t){return t.NewsID}),p=d3.map(n,function(t){return t[1]}),f=1e3,h=(d3.scaleLinear().domain([0,1]).range([0,f]),d3.select(".histogram")),m=h.append("div").attr("class","histogram-chart-toggle-wrapper");m.append("div").attr("class","histogram-chart-toggle-size").selectAll("p").data([0,20,50,100,500]).enter().append("p").attr("class","histogram-chart-toggle-item").text(function(t){return t}).on("click",function(t){u=t,i()}),m.append("div").attr("class","histogram-chart-toggle-type").selectAll("p").data(["race","gender","supWhite","supGender"]).enter().append("p").attr("class","histogram-chart-toggle-item").text(function(t){return t}).on("click",function(t){l=t,i()}),i()}Object.defineProperty(e,"__esModule",{value:!0});var n=[["Maine","ME",1,"Northeast",23],["Vermont","VT",2,"Northeast",50],["New Hampshire","NH",3,"Northeast",33],["Rhode Island","RI",4,"Northeast",44],["Massachusetts","MA",5,"Northeast",25],["Connecticut","CT",6,"Northeast",9],["Delaware","DE",7,"Northeast",10],["New Jersey","NJ",8,"Northeast",34],["New York","NY",9,"Northeast",36],["Pennsylvania","PA",10,"Northeast",42],["District of Columbia","DC",11,"Northeast",11],["Maryland","MD",12,"Northeast",24],["Virginia","VA",13,"South",51],["North Carolina","NC",14,"South",37],["South Carolina","SC",15,"South",45],["Georgia","GA",16,"South",13],["Alabama","AL",17,"South",1],["Mississippi","MS",18,"South",28],["Louisiana","LA",19,"South",22],["Arkansas","AR",20,"South",5],["Tennessee","TN",21,"South",47],["Kentucky","KY",22,"South",21],["West Virginia","WV",23,"South",54],["Oklahoma","OK",24,"Midwest",40],["Colorado","CO",25,"West",8],["Utah","UT",26,"West",49],["Idaho","ID",27,"West",16],["Wyoming","WY",28,"West",56],["Montana","MT",29,"West",30],["North Dakota","ND",30,"Midwest",38],["South Dakota","SD",31,"Midwest",46],["Nebraska","NE",32,"Midwest",31],["Kansas","KS",33,"Midwest",20],["Iowa","IA",34,"Midwest",19],["Minnesota","MN",35,"Midwest",27],["Wisconsin","WI",36,"Midwest",55],["Indiana","IN",37,"Midwest",18],["Missouri","MO",38,"Midwest",29],["Ohio","OH",39,"Midwest",39],["Michigan","MI",40,"Midwest",26],["Illinois","IL",41,"Midwest",17],["Florida","FL",42,"South",12],["California","CA",43,"West",6],["Nevada","NV",44,"West",32],["Texas","TX",45,"South",48],["Arizona","AZ",46,"West",4],["New Mexico","NM",47,"West",35],["Alaska","AK",48,"West",2],["Washington","WA",49,"West",53],["Oregon","OR",50,"West",41],["Hawaii","HI",51,"West",15]];e.default={init:r}},function(t,e,a){"use strict";function r(t,e,a,r,n){}Object.defineProperty(e,"__esModule",{value:!0});e.default={init:r}},function(t,e,a){"use strict";function r(t,e,a,r){function o(t){return"gender"==l?+(t.total_num-t.male_num)/t.total_num:"supWhite"==l?+t.white_sup_num/t.total_sup_num:"supGender"==l?+t.male_sup_num/t.total_sup_num:(+t.total_num-+t.white_num)/t.total_num}function s(t,e){return"gender"==t?+(e.total_num-e.male_num)/e.total_num:"supWhite"==t?+e.white_sup_num/e.total_sup_num:"supGender"==t?(+e.total_sup_num-+e.male_sup_num)/e.total_sup_num:(+e.total_num-+e.white_num)/e.total_num}function i(){d3.selectAll(".scatter-chart-wrapper").remove();var e=h.append("div").attr("class","scatter-chart-wrapper").style("width",p+d.left+d.right+"px"),a=e.append("svg").attr("class","scatter-chart-wrapper-svg-double-change").attr("width",p+d.left+d.right).attr("height",f+d.top+d.bottom).style("width",p+d.left+d.right+"px").style("height",f+d.top+d.bottom+"px"),r=t.filter(function(t){return"supWhite"==l||"supGender"==l?t.total_num>u&&t.total_sup_num>0:t.total_num>u}),n=[],i=[],m=[],v=d3.nest().key(function(t){return+t.NewsID}).rollup(function(t){var e=d3.map(t,function(t){return t.Year}),a=d3.max(t,function(t){return t.total_num}),r=d3.max(t,function(t){return o(t)});return n.push(r),{yearMap:e,values:t,maxTotal:a}}).entries(r);v=v.filter(function(t){return t.value.yearMap.has(2014)?t:null});for(var g in v){var y=o(v[g].value.yearMap.get(2014))-o(v[g].value.values[0]);l="supGender";var w=o(v[g].value.yearMap.get(2014))-o(v[g].value.values[0]);l="gender",i.push(y),m.push(w),v[g].value.companyName=c.get(v[g].key).Company,v[g].value.diff=y,v[g].value.raceDiff=w}var x=d3.extent(v,function(t){return+t.value.maxTotal}),M=d3.scaleLinear().domain(x).range([5,30]),_=(d3.extent(n,function(t){return t}),d3.extent(i,function(t){return t})),b=d3.extent(m,function(t){return t}),k=(d3.scaleLinear().domain([_[0],_[1]]).range([0,p]),d3.scaleLinear().domain([b[0],b[1]]).range([f,0]),d3.scaleLinear().domain([_[0],0,_[1]]).range(["red","white","green"]),d3.scaleLinear().domain([_[0],0,_[1]]).range(["red","grey","green"]),d3.scaleLinear().domain([.2,.8]).range([0,p]).clamp(!0)),N=d3.scaleLinear().domain([.2,.8]).range([f,0]).clamp(!0);!function(){var t=a.append("g").attr("transform","translate("+d.left+","+d.top+")").attr("class","swarm-axis"),e=t.append("g");e.append("line").attr("x1",p/2).attr("x2",p/2).attr("y1",0).attr("y2",f).attr("class","swarm-axis-line"),e.append("g").append("line").attr("x1",0).attr("x2",p).attr("y1",f/2).attr("y2",f/2).attr("class","swarm-axis-line");var r=t.append("g");r.append("g").selectAll("text").data(["100% Female Leaders","100% Male Leaders"]).enter().append("text").attr("x",function(t,e){return p/2}).attr("y",function(t,e){return 0==e?0:f}).attr("class","swarm-axis-tick-text").text(function(t){return t}).style("text-anchor",function(t,e){return"middle"}).style("dominant-baseline","text-after-edge"),r.append("g").selectAll("text").data(["100% Male Staff","100% Female Staff"]).enter().append("text").attr("x",function(t,e){return 0==e?0:p}).attr("y",f/2).attr("class","swarm-axis-tick-text").text(function(t){return t}).style("text-anchor",function(t,e){return 0==e?"end":"start"})}(),a.append("g").attr("transform","translate("+d.left+","+d.top+")").selectAll("circle").data(v).enter().append("circle").attr("class","scatter-circle-double-axis").attr("r",function(t){return M(t.value.yearMap.get(2014).total_num)}).attr("cx",function(t){return k(s("gender",t.value.yearMap.get(2014)))}).attr("cy",function(t){return N(s("supGender",t.value.yearMap.get(2014)))}).on("mouseover",function(t){}),e.append("div").attr("class","swarm-chart-logos").style("transform","translate("+d.left+"px,"+d.top+"px)").selectAll("div").data(v).enter().append("div").style("transform",function(t){return"translate("+k(s("gender",t.value.yearMap.get(2014)))+"px,"+N(s("supGender",t.value.yearMap.get(2014)))+"px)"}).attr("class","swarm-chart-logo-container").append("div").style("width",function(t){return"1px"}).style("height",function(t){return"1px"}).attr("class","swarm-chart-logo").style("width",function(t){return 2*M(t.value.yearMap.get(2014).total_num)+"px"}).style("height",function(t){return 2*M(t.value.yearMap.get(2014).total_num)+"px"}).style("background-image",function(t){if("the new york times"==t.value.companyName)return"url(assets/ny-times-logo.svg)"})}var l="gender",u=100,c=(d3.map(e,function(t){return t.NewsID}),d3.map(a,function(t){return t.NewsID}),d3.map(r,function(t){return t.NewsID})),d=(d3.map(n,function(t){return t[1]}),{top:40,right:40,bottom:40,left:40}),p=500-d.left-d.right,f=500-d.top-d.bottom,h=(d3.scaleLinear().domain([0,1]).range([0,p]),d3.select(".scatter"));!function(){var t=h.append("div").attr("class","histogram-chart-toggle-wrapper"),e=[0,20,50,100,500];t.append("div").attr("class","histogram-chart-toggle-size").selectAll("p").data(e).enter().append("p").attr("class",function(t,a){return 0==a?"toggle-selected front-curve histogram-chart-toggle-item":a==e.length-1?"back-curve histogram-chart-toggle-item":"histogram-chart-toggle-item"}).text(function(t){return t}).on("click",function(t){var e=t;d3.select(this.parentNode).selectAll("p").classed("toggle-selected",function(t){return t==e}),u=t,i()});var a=["gender","race"];t.append("div").attr("class","histogram-chart-toggle-type histogram-chart-toggle-first").selectAll("p").data(a).enter().append("p").attr("class",function(t,e){return 0==e?"toggle-selected front-curve histogram-chart-toggle-item":e==a.length-1?"back-curve histogram-chart-toggle-item":"histogram-chart-toggle-item"}).text(function(t){return"race"==t?"Race":"Gender"}).on("click",function(t){var e=t;d3.select(this.parentNode).selectAll("p").classed("toggle-selected",function(t){return t==e}),l=t,i()});var r=["all","leader"];t.append("div").attr("class","histogram-chart-toggle-type").selectAll("p").data(r).enter().append("p").attr("class",function(t,e){return 0==e?"toggle-selected front-curve histogram-chart-toggle-item":e==r.length-1?"back-curve histogram-chart-toggle-item":"histogram-chart-toggle-item"}).text(function(t){return"all"==t?"All Staff":"Leadership"}).on("click",function(t){var e=t;d3.select(this.parentNode).selectAll("p").classed("toggle-selected",function(t){return t==e}),group=t,i()})}(),i()}Object.defineProperty(e,"__esModule",{value:!0});var n=[["Maine","ME",1,"Northeast",23],["Vermont","VT",2,"Northeast",50],["New Hampshire","NH",3,"Northeast",33],["Rhode Island","RI",4,"Northeast",44],["Massachusetts","MA",5,"Northeast",25],["Connecticut","CT",6,"Northeast",9],["Delaware","DE",7,"Northeast",10],["New Jersey","NJ",8,"Northeast",34],["New York","NY",9,"Northeast",36],["Pennsylvania","PA",10,"Northeast",42],["District of Columbia","DC",11,"Northeast",11],["Maryland","MD",12,"Northeast",24],["Virginia","VA",13,"South",51],["North Carolina","NC",14,"South",37],["South Carolina","SC",15,"South",45],["Georgia","GA",16,"South",13],["Alabama","AL",17,"South",1],["Mississippi","MS",18,"South",28],["Louisiana","LA",19,"South",22],["Arkansas","AR",20,"South",5],["Tennessee","TN",21,"South",47],["Kentucky","KY",22,"South",21],["West Virginia","WV",23,"South",54],["Oklahoma","OK",24,"Midwest",40],["Colorado","CO",25,"West",8],["Utah","UT",26,"West",49],["Idaho","ID",27,"West",16],["Wyoming","WY",28,"West",56],["Montana","MT",29,"West",30],["North Dakota","ND",30,"Midwest",38],["South Dakota","SD",31,"Midwest",46],["Nebraska","NE",32,"Midwest",31],["Kansas","KS",33,"Midwest",20],["Iowa","IA",34,"Midwest",19],["Minnesota","MN",35,"Midwest",27],["Wisconsin","WI",36,"Midwest",55],["Indiana","IN",37,"Midwest",18],["Missouri","MO",38,"Midwest",29],["Ohio","OH",39,"Midwest",39],["Michigan","MI",40,"Midwest",26],["Illinois","IL",41,"Midwest",17],["Florida","FL",42,"South",12],["California","CA",43,"West",6],["Nevada","NV",44,"West",32],["Texas","TX",45,"South",48],["Arizona","AZ",46,"West",4],["New Mexico","NM",47,"West",35],["Alaska","AK",48,"West",2],["Washington","WA",49,"West",53],["Oregon","OR",50,"West",41],["Hawaii","HI",51,"West",15]];e.default={init:r}},function(t,e,a){"use strict";function r(t,e,a,r){function o(t){return"gender"==i?+t.male_num/t.total_num:"supWhite"==i?+t.white_sup_num/t.total_sup_num:"supGender"==i?+t.male_sup_num/t.total_sup_num:+t.white_num/t.total_num}function s(){d3.selectAll(".slope-chart-wrapper").remove();var e=f.append("svg").attr("class","slope-chart-wrapper").attr("width",d).attr("height",p),a=f.append("div").attr("class","slope-mini-multiple-div"),r=t.filter(function(t){return"supWhite"==i||"supGender"==i?t.total_num>l&&t.total_sup_num>0:t.total_num>l}),n=d3.nest().key(function(t){return+t.NewsID}).rollup(function(t){return{yearMap:d3.map(t,function(t){return t.Year}),values:t,maxTotal:d3.max(t,function(t){return t.total_num})}}).entries(r);n=n.filter(function(t){return t.value.yearMap.has(2014)?t:null});var s=d3.extent(n,function(t){return+t.value.maxTotal}),h=(d3.scaleLinear().domain(s).range([5,30]),e.append("g").attr("transform","translate("+c.left+","+c.top+")")),v=(h.append("g").selectAll("circle").data(n).enter().append("circle").attr("class","swarm-circle").attr("r",function(t){return 3}).attr("cx",function(t){return m(o(t.value.yearMap.get(2014)))}).attr("cy",function(t){return 0}).style("fill",function(t){var e=o(t.value.yearMap.get(2014))-o(t.value.values[0]);return e>.01?"red":e<.01?"green":void 0}).on("mouseover",function(t){console.log(t)}),h.append("g").selectAll("circle").data(n).enter().append("circle").attr("class","swarm-circle").attr("r",function(t){return 3}).attr("cx",function(t){return m(o(t.value.values[0]))}).attr("cy",function(t){return 100}).style("fill",function(t){var e=o(t.value.yearMap.get(2014))-o(t.value.values[0]);return e>.01?"red":e<.01?"green":void 0}),h.append("g").selectAll("line").data(n).enter().append("line").attr("class","slope-line").attr("x2",function(t){return m(o(t.value.values[0]))}).attr("y2",function(t){return 100}).attr("x1",function(t){return m(o(t.value.yearMap.get(2014)))}).attr("y1",function(t){return 0}).style("stroke",function(t){var e=o(t.value.yearMap.get(2014))-o(t.value.values[0]);return e>.01?"red":e<.01?"green":void 0}),d3.scaleLinear().domain([.3,1]).range([100,0])),g=a.selectAll("div").data(n).enter().append("div").attr("class","mini-multiple-div");g.append("p").attr("class","mini-multiple-text").style("margin-top",20).text(function(t){return u.get(t.value.values[0].NewsID).Company});var y=g.append("svg").attr("class","slope-mini-svg").attr("height",100).style("height","100px");y.append("circle").attr("cx",function(t){return 0}).attr("cy",function(t){return v(o(t.value.values[0]))}).attr("r",2).attr("class","slope-small-dot").style("fill",function(t){var e=o(t.value.yearMap.get(2014))-o(t.value.values[0]);return e>.01?"red":e<.01?"green":void 0}),y.append("circle").attr("cx",function(t){return 40}).attr("cy",function(t){return v(o(t.value.yearMap.get(2014)))}).attr("r",2).attr("class","slope-small-dot").style("fill",function(t){var e=o(t.value.yearMap.get(2014))-o(t.value.values[0]);return e>.01?"red":e<.01?"green":void 0}),y.selectAll("line").data([0,1,2,4,5]).enter().append("line").attr("class","slope-line-axis").attr("y1",function(t,e){return 20*e+"%"}).attr("x1",function(t){return 0}).attr("y2",function(t,e){return 20*e+"%"}).attr("x2",function(t){return 40}),y.append("line").attr("class","slope-line").attr("y1",function(t){return v(o(t.value.values[0]))}).attr("x1",function(t){return 0}).attr("y2",function(t){return v(o(t.value.yearMap.get(2014)))}).attr("x2",function(t){return 40}).style("stroke",function(t){var e=o(t.value.yearMap.get(2014))-o(t.value.values[0]);return e>.01?"red":e<.01?"green":void 0})}var i="gender",l=100,u=(d3.map(e,function(t){return t.NewsID}),d3.map(a,function(t){return t.NewsID}),d3.map(r,function(t){return t.NewsID})),c=(d3.map(n,function(t){return t[1]}),{top:40,right:40,bottom:40,left:40}),d=1e3-c.left-c.right,p=500-c.top-c.bottom,f=(d3.scaleLinear().domain([0,1]).range([0,d]),d3.select(".slope-chart")),h=f.append("div").attr("class","histogram-chart-toggle-wrapper");h.append("div").attr("class","histogram-chart-toggle-size").selectAll("p").data([0,20,50,100,500]).enter().append("p").attr("class","histogram-chart-toggle-item").text(function(t){return t}).on("click",function(t){l=t,s()}),h.append("div").attr("class","histogram-chart-toggle-type").selectAll("p").data(["race","gender","supWhite","supGender"]).enter().append("p").attr("class","histogram-chart-toggle-item").text(function(t){return t}).on("click",function(t){i=t,s()});var m=d3.scaleLinear().domain([.54,.75]).range([0,d]);s()}Object.defineProperty(e,"__esModule",{value:!0});var n=[["Maine","ME",1,"Northeast",23],["Vermont","VT",2,"Northeast",50],["New Hampshire","NH",3,"Northeast",33],["Rhode Island","RI",4,"Northeast",44],["Massachusetts","MA",5,"Northeast",25],["Connecticut","CT",6,"Northeast",9],["Delaware","DE",7,"Northeast",10],["New Jersey","NJ",8,"Northeast",34],["New York","NY",9,"Northeast",36],["Pennsylvania","PA",10,"Northeast",42],["District of Columbia","DC",11,"Northeast",11],["Maryland","MD",12,"Northeast",24],["Virginia","VA",13,"South",51],["North Carolina","NC",14,"South",37],["South Carolina","SC",15,"South",45],["Georgia","GA",16,"South",13],["Alabama","AL",17,"South",1],["Mississippi","MS",18,"South",28],["Louisiana","LA",19,"South",22],["Arkansas","AR",20,"South",5],["Tennessee","TN",21,"South",47],["Kentucky","KY",22,"South",21],["West Virginia","WV",23,"South",54],["Oklahoma","OK",24,"Midwest",40],["Colorado","CO",25,"West",8],["Utah","UT",26,"West",49],["Idaho","ID",27,"West",16],["Wyoming","WY",28,"West",56],["Montana","MT",29,"West",30],["North Dakota","ND",30,"Midwest",38],["South Dakota","SD",31,"Midwest",46],["Nebraska","NE",32,"Midwest",31],["Kansas","KS",33,"Midwest",20],["Iowa","IA",34,"Midwest",19],["Minnesota","MN",35,"Midwest",27],["Wisconsin","WI",36,"Midwest",55],["Indiana","IN",37,"Midwest",18],["Missouri","MO",38,"Midwest",29],["Ohio","OH",39,"Midwest",39],["Michigan","MI",40,"Midwest",26],["Illinois","IL",41,"Midwest",17],["Florida","FL",42,"South",12],["California","CA",43,"West",6],["Nevada","NV",44,"West",32],["Texas","TX",45,"South",48],["Arizona","AZ",46,"West",4],["New Mexico","NM",47,"West",35],["Alaska","AK",48,"West",2],["Washington","WA",49,"West",53],["Oregon","OR",50,"West",41],["Hawaii","HI",51,"West",15]];e.default={init:r}},function(t,e,a){"use strict";function r(t,e,a,r,o){function s(t){return"gender"==d&&"all"==p?d3.mean(t,function(t){return(t.total_num-t.male_num)/t.total_num}):"race"==d&&"all"!=p?d3.mean(t,function(t){return(+t.total_sup_num-+t.white_sup_num)/t.total_sup_num}):"gender"==d&&"all"!=p?d3.mean(t,function(t){return(+t.total_sup_num-+t.male_sup_num)/t.total_sup_num}):d3.mean(t,function(t){return(+t.total_num-+t.white_num)/t.total_num})}function i(t){return"gender"==d&&"all"==p?+(t.total_num-t.male_num)/t.total_num:"race"==d&&"all"!=p?(+t.total_sup_num-+t.white_sup_num)/t.total_sup_num:"gender"==d&&"all"!=p?(+t.total_sup_num-+t.male_sup_num)/t.total_sup_num:(+t.total_num-+t.white_num)/t.total_num}function l(){function e(t){var e=d3.forceCollide().radius(function(t){return t.radius+1}).iterations(1),n=d3.forceSimulation(t).force("x",d3.forceX(function(t){return b(i(t))}).strength(1)).force("y",d3.forceY(g/2)).force("collide",e).stop(),o=a.append("svg").attr("class","swarm-chart-wrapper").attr("width",v+m.left+m.right).attr("height",g+m.top+m.bottom);!function(){var t=o.append("g").attr("transform","translate("+m.left+","+m.top+")").attr("class","swarm-axis"),e=[.2,.3,.5,.7,.8];"race"==d&&(e=[0,.3,.5,.7,1]);var a=t.append("g").attr("class","swarm-axis-tick-container").selectAll("g").data(e).enter().append("g").attr("class","swarm-axis-tick-g");a.append("line").style("stroke",function(t){return.5==t?"#888":_(t)}).attr("x1",function(t){return b(t)}).attr("x2",function(t){return b(t)}).attr("y1",function(t,e){return.5==t?g/2:0}).attr("y2",function(t){return.5==t?0:.05*g}).attr("class","swarm-axis-tick"),a.append("text").attr("x",function(t){return b(t)}).attr("y",-6).attr("class","swarm-axis-tick-text").style("text-anchor",function(t,a){return 0==a?"start":a==e.length-1?"end":null}).style("fill",function(t,e){return.5==t?"#888":_(t)}).text(function(t,a){return 0==a?"race"==d?Math.floor(100*(1-t))+"% White Staff":Math.floor(100*(1-t))+"% Male Staff":a==e.length-1?"race"==d?Math.floor(100*t)+"% Non-White Staff":Math.floor(100*t)+"% Female Staff":.5==t?"50/50  Split":t<.5?Math.floor(100*(1-t))+"%":Math.floor(100*t)+"%"}),t.append("g").append("line").attr("x1",0).attr("x2",v).attr("y1",g/2).attr("y2",g/2).attr("class","swarm-axis-line")}();for(var s=o.append("g").attr("transform","translate("+m.left+","+m.top+")"),l=0;l<250;++l)n.tick();s.selectAll("g").data(t).enter().append("g").append("circle").attr("class","swarm-circle").attr("r",function(t){return t.radius}).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).on("mouseover",function(t){var e=t;r.style("visibility","visible").style("top",e.y+e.radius+"px").style("left",e.x+e.radius+50+"px").text(h.get(t.NewsID).Company+" - "+Math.floor(100*i(t))+"%")}).on("mouseout",function(t){r.style("visibility",null).text("")}).style("fill",function(t){var e=i(t);return _(e)})}d3.selectAll(".swarm-leader-chart-container").remove();var a=y.append("div").attr("class","swarm-leader-chart-container").style("width",v+m.left+m.right+"px"),r=a.append("div").attr("class","swarm-chart-tool-tip").attr("transform","translate("+m.left+","+m.top+")").text(function(t){return t}),n=t.filter(function(t){return"supWhite"==d||"supGender"==d?t.total_num>f&&t.total_sup_num>0:t.total_num>f}),o=d3.nest().key(function(t){return+t.Year}).rollup(function(t){return{average:s(t),values:t}}).entries(n),l=d3.nest().key(function(t){return+t.NewsID}).rollup(function(t){return{yearMap:d3.map(t,function(t){return t.Year}),values:t,maxTotal:d3.max(t,function(t){return t.total_num})}}).entries(n),p=[];l=l.filter(function(t){return t.value.yearMap.has(u)?t:null});for(var w in l){l[w].companyName=h.get(l[w].key).Company,l[w].top3Data=c.get(l[w].companyName);var x=i(l[w].value.yearMap.get(u))-i(l[w].value.values[0]);p.push(x),l[w].value.diff=x}var M=(d3.map(l,function(t){return t.key}),d3.extent(p,function(t){return t})),_=(d3.scaleLinear().domain(M).range(["green","red"]),d3.scaleLinear().domain([.2,.5,.8]).range(["#2161fa","#dddddd","#ff3333"]));"race"==d&&_.domain([0,.5,1]);var k=o.filter(function(t){return t.key==u})[0].value.values,N=d3.extent(k,function(t){return+t.total_num}),S=d3.scaleLinear().domain(N).range([5,30]);k.forEach(function(t,e){t.radius=S(t.total_num),t.companyName=h.get(+t.NewsID).Company,t.top3Data=c.get(t.companyName)});var A=d3.nest().key(function(t){return+t.top3Data["TOP3-nonwhite"]>0?1:0}).entries(k);e(A[0].values),e(A[1].values)}var u=2015,c=d3.map(o,function(t){return t.Organization.toLowerCase()}),d="race",p="all",f=50,h=(d3.map(e,function(t){return t.NewsID}),d3.map(a,function(t){return t.NewsID}),d3.map(r,function(t){return t.NewsID})),m=(d3.map(n,function(t){return t[1]}),{top:40,right:40,bottom:20,left:40}),v=1e3-m.left-m.right,g=250-m.top-m.bottom,y=(d3.scaleLinear().domain([0,1]).range([0,v]),d3.select(".swarm-leader")),w=y.append("div").attr("class","histogram-chart-toggle-wrapper"),x=[0,20,50,100,500];w.append("div").attr("class","histogram-chart-toggle-size").selectAll("p").data(x).enter().append("p").attr("class",function(t,e){return 0==e?"toggle-selected front-curve histogram-chart-toggle-item":e==x.length-1?"back-curve histogram-chart-toggle-item":"histogram-chart-toggle-item"}).text(function(t){return t}).on("click",function(t){var e=t;d3.select(this.parentNode).selectAll("p").classed("toggle-selected",function(t){return t==e}),f=t,l()});var M=["gender","race"];w.append("div").attr("class","histogram-chart-toggle-type").selectAll("p").data(M).enter().append("p").attr("class",function(t,e){return 0==e?"toggle-selected front-curve histogram-chart-toggle-item":e==M.length-1?"back-curve histogram-chart-toggle-item":"histogram-chart-toggle-item"}).text(function(t){return"race"==t?"Race":"Gender"}).on("click",function(t){var e=t;d3.select(this.parentNode).selectAll("p").classed("toggle-selected",function(t){return t==e}),d=t,l()});var _=["all","leader"];w.append("div").attr("class","histogram-chart-toggle-type").selectAll("p").data(_).enter().append("p").attr("class",function(t,e){return 0==e?"toggle-selected front-curve histogram-chart-toggle-item":e==_.length-1?"back-curve histogram-chart-toggle-item":"histogram-chart-toggle-item"}).text(function(t){return"all"==t?"All Staff":"Leadership"}).on("click",function(t){var e=t;d3.select(this.parentNode).selectAll("p").classed("toggle-selected",function(t){return t==e}),p=t,l()});var b=d3.scaleLinear().domain([.2,.8]).range([0,v]);"race"==d&&b.domain([0,1]),l()}Object.defineProperty(e,"__esModule",{value:!0});var n=[["Maine","ME",1,"Northeast",23],["Vermont","VT",2,"Northeast",50],["New Hampshire","NH",3,"Northeast",33],["Rhode Island","RI",4,"Northeast",44],["Massachusetts","MA",5,"Northeast",25],["Connecticut","CT",6,"Northeast",9],["Delaware","DE",7,"Northeast",10],["New Jersey","NJ",8,"Northeast",34],["New York","NY",9,"Northeast",36],["Pennsylvania","PA",10,"Northeast",42],["District of Columbia","DC",11,"Northeast",11],["Maryland","MD",12,"Northeast",24],["Virginia","VA",13,"South",51],["North Carolina","NC",14,"South",37],["South Carolina","SC",15,"South",45],["Georgia","GA",16,"South",13],["Alabama","AL",17,"South",1],["Mississippi","MS",18,"South",28],["Louisiana","LA",19,"South",22],["Arkansas","AR",20,"South",5],["Tennessee","TN",21,"South",47],["Kentucky","KY",22,"South",21],["West Virginia","WV",23,"South",54],["Oklahoma","OK",24,"Midwest",40],["Colorado","CO",25,"West",8],["Utah","UT",26,"West",49],["Idaho","ID",27,"West",16],["Wyoming","WY",28,"West",56],["Montana","MT",29,"West",30],["North Dakota","ND",30,"Midwest",38],["South Dakota","SD",31,"Midwest",46],["Nebraska","NE",32,"Midwest",31],["Kansas","KS",33,"Midwest",20],["Iowa","IA",34,"Midwest",19],["Minnesota","MN",35,"Midwest",27],["Wisconsin","WI",36,"Midwest",55],["Indiana","IN",37,"Midwest",18],["Missouri","MO",38,"Midwest",29],["Ohio","OH",39,"Midwest",39],["Michigan","MI",40,"Midwest",26],["Illinois","IL",41,"Midwest",17],["Florida","FL",42,"South",12],["California","CA",43,"West",6],["Nevada","NV",44,"West",32],["Texas","TX",45,"South",48],["Arizona","AZ",46,"West",4],["New Mexico","NM",47,"West",35],["Alaska","AK",48,"West",2],["Washington","WA",49,"West",53],["Oregon","OR",50,"West",41],["Hawaii","HI",51,"West",15]];e.default={init:r}},function(t,e,a){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function n(t,e){t.each(function(){for(var t,a=d3.select(this),r=a.text().split(/\s+/).reverse(),n=[],o=0,s=a.attr("y"),i=parseFloat(a.attr("dy")),l=a.text(null).append("tspan").attr("x",0).attr("y",s).attr("dy",i+"em");t=r.pop();)n.push(t),l.text(n.join(" ")),l.node().getComputedTextLength()>e&&(n.pop(),l.text(n.join(" ")),n=[t],l=a.append("tspan").attr("x",0).attr("y",s).attr("dy",1.3*++o+i+"em").text(t))})}function o(t,e){t.each(function(){for(var t,a=d3.select(this),r=a.text().split(/\s+/).reverse(),n=[],o=0,s=a.attr("y"),i=parseFloat(a.attr("dy")),l=a.text(null).append("tspan").attr("x",0).attr("y",s).attr("dy",i+"em").style("font-weight",500);t=r.pop();)n.push(t),l.text(n.join(" ")),l.node().getComputedTextLength()>e&&(n.pop(),l.text(n.join(" ")),n=[t],l=a.append("tspan").style("font-size","12px").attr("x",0).attr("y",s).attr("dy",1.05*++o+i+"em").text(t))})}function s(t,e,a,r,s,i,u){function d(t){return"gender"==et&&"all"==at?+(t.total_num-t.male_num)/t.total_num:"race"==et&&"all"!=at?(+t.total_sup_num-+t.white_sup_num)/t.total_sup_num:"gender"==et&&"all"!=at?(+t.total_sup_num-+t.male_sup_num)/t.total_sup_num:(+t.total_num-+t.white_num)/t.total_num}function x(t,e){var a=e.yearMap.get(J);if("gender-old"==t){if(t="gender",a=e.values.filter(function(t){return+t.Year==$}),!(a.length>0))return"n/a";a=a[0]}if("race-old"==t){if(t="race",a=e.values.filter(function(t){return+t.Year==$}),!(a.length>0))return"n/a";a=a[0]}if("white-old"==t){if(t="white",a=e.values.filter(function(t){return+t.Year==$}),!(a.length>0))return"n/a";a=a[0]}if("black-old"==t){if(t="black",a=e.values.filter(function(t){return+t.Year==$}),!(a.length>0))return"n/a";a=a[0]}if("hisp-old"==t){if(t="hisp",a=e.values.filter(function(t){return+t.Year==$}),!(a.length>0))return"n/a";a=a[0]}if("asian-old"==t){if(t="asian",a=e.values.filter(function(t){return+t.Year==$}),!(a.length>0))return"n/a";a=a[0]}if("sup-white-old"==t){if(t="supWhiteRaw",a=e.values.filter(function(t){return+t.Year==$}),!(a.length>0))return"n/a";a=a[0]}if("sup-gender-old"==t){if(t="supGender",a=e.values.filter(function(t){return+t.Year==$}),!(a.length>0))return"n/a";a=a[0]}if("sup-black-old"==t){if(t="supBlack",a=e.values.filter(function(t){return+t.Year==$}),!(a.length>0))return"n/a";a=a[0]}if("sup-hisp-old"==t){if(t="supHisp",a=e.values.filter(function(t){return+t.Year==$}),!(a.length>0))return"n/a";a=a[0]}if("sup-asian-old"==t){if(t="supAsian",a=e.values.filter(function(t){return+t.Year==$}),!(a.length>0))return"n/a";a=a[0]}if("gender"==t)return+(a.total_num-a.male_num)/a.total_num;if("supWhite"==t)return(+a.total_sup_num-+a.white_sup_num)/a.total_sup_num;if("supBlack"==t)return+a.black_sup_num/a.total_sup_num;if("supHisp"==t)return+a.hisp_sup_num/a.total_sup_num;if("supAsian"==t)return+a.asian_sup_num/a.total_sup_num;if("supWhiteAdjusted"==t){var r=(+a.total_sup_num-+a.white_sup_num)/a.total_sup_num-(1-e.whiteCensus);return r}if("supGender"==t)return(+a.total_sup_num-+a.male_sup_num)/a.total_sup_num;if("raceRaw"==t)return(+a.total_num-+a.white_num)/a.total_num;if("white"==t)return+a.white_num/a.total_num;if("black"==t)return+a.black_num/a.total_num;if("hisp"==t)return+a.hisp_num/a.total_num;if("asian"==t)return+a.asian_num/a.total_num;if("supWhiteRaw"==t)return+a.white_sup_num/a.total_sup_num;if("genderStaff"==t)return+(a.total_num-a.male_num-(+a.total_sup_num-+a.male_sup_num))/(a.total_num-a.total_sup_num);if("raceStaff"==t)return(+a.total_num-+a.white_num-(+a.total_sup_num-+a.white_sup_num))/(a.total_num-a.total_sup_num);if("whiteStaff"==t)return(+a.white_num-+a.white_sup_num)/(a.total_num-a.total_sup_num);if("blackStaff"==t)return(+a.black_num-+a.black_sup_num)/(a.total_num-a.total_sup_num);if("hispStaff"==t)return(+a.hisp_num-+a.hisp_sup_num)/(a.total_num-a.total_sup_num);if("asianStaff"==t)return(+a.asian_num-+a.asian_sup_num)/(a.total_num-a.total_sup_num);var r=(+a.total_num-+a.white_num)/a.total_num-(1-e.whiteCensus);return r}function M(){function t(){e(this.value.trim())}function e(t){if(t.length>2){G.style("color",null).style("text-decoration",null),F="";var e=new RegExp("\\b"+function(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}(t),"i");P.style("display",function(t,a){return e.test(t.value.companyName)?"block":"none"})}else P.style("display",null)}R.on("keyup",t)}function _(t){function e(e){"swarm"!=t&&"new"!=t||e.style("stroke-width","2px").style("stroke",d3.color(e.style("stroke")).darker(u))}function a(e,a){_t.selectAll("div").remove();var r=_t.append("div"),n=(r.append("p").attr("class","swarm-chart-tool-tip-company").style("text-transform",function(t){return"usa today"==e.value.companyName?"none":null}).html(function(t){var a=N.indexOf(+e.key),r="";return r="usa today"==e.value.companyName?"USA Today":e.value.companyName.length>30?e.value.companyName.replace(/\b\w/g,function(t){return t.toUpperCase()}).slice(0,30)+"...":e.value.companyName.replace(/\b\w/g,function(t){return t.toUpperCase()}),-1==a&&(r+="<span>2017 data</span>"),r}),["white","black","hisp.","asian","female"]),o=[{cut:"leaders",cols:n},{cut:"staff",cols:n},{cut:"census",cols:n}],s=r.selectAll("div").data(o).enter().append("div").attr("class","swarm-chart-tool-tip-row"),i=(s.append("p").attr("class","swarm-chart-tool-tip-row-label").html(function(a){if("census"==a.cut){var r="";return e.value.companyData.hasOverride?(r=e.value.companyData.override.coverage_area)>30&&(r=r.slice(0,27)+"..."):r=e.value.companyData.City+", "+e.value.companyData.State,"census<span>"+r+"</span>"}return"staff"==a.cut&&"swarm-scatter"!=t?"all":a.cut}),s.selectAll("div").data(function(t){return t.cols}).enter().append("div").attr("class","swarm-chart-tool-tip-col"));i.append("p").attr("class","swarm-chart-tool-tip-col-label").text(function(t){return"leaders"==d3.select(this.parentNode.parentNode).datum().cut?t:null}),i.append("p").text(function(a){var r=d3.select(this.parentNode.parentNode).datum().cut;if("census"==r){if("female"==a){var n=e.value.femaleCensus;return"n/a"==n?n:Math.round(100*e.value.femaleCensus)+"%"}if("white"==a)return Math.round(100*e.value.whiteCensus)+"%";if("hisp."==a)return Math.round(100*e.value.hispanicCensus)+"%";if("black"==a)return Math.round(100*e.value.blackCensus)+"%";if("asian"==a)return Math.round(100*e.value.asianCensus)+"%"}if("staff"==r){if("swarm-scatter"==t){if("white"==a)return Math.round(100*x("whiteStaff",e.value))+"%";if("black"==a)return Math.round(100*x("blackStaff",e.value))+"%";if("hisp."==a)return Math.round(100*x("hispStaff",e.value))+"%";if("asian"==a)return Math.round(100*x("asianStaff",e.value))+"%";if("female"==a)return Math.round(100*x("genderStaff",e.value))+"%"}if("white"==a)return Math.round(100*x("white",e.value))+"%";if("black"==a)return Math.round(100*x("black",e.value))+"%";if("hisp."==a)return Math.round(100*x("hisp",e.value))+"%";if("asian"==a)return Math.round(100*x("asian",e.value))+"%";if("female"==a)return Math.round(100*x("gender",e.value))+"%"}if(r="leaders"){if("white"==a)return Math.round(100*x("supWhiteRaw",e.value))+"%";if("black"==a)return Math.round(100*x("supBlack",e.value))+"%";if("hisp."==a)return Math.round(100*x("supHisp",e.value))+"%";if("asian"==a)return Math.round(100*x("supAsian",e.value))+"%";if("female"==a)return Math.round(100*x("supGender",e.value))+"%"}return"tbd"}).attr("class","swarm-chart-tool-tip-text"),"swarm"==t||"new"==t?(a.style("stroke",function(){return"black"}),_t.style("visibility","visible").style("top",function(t){return h<450||f?"0px":e.y+st+"px"}).style("left",function(t){return h<450||f?"0px":e.x+e.value.radius+ot+"px"})):"swarm-scatter"==t&&(a.style("stroke",function(){return"black"}),_t.style("visibility","visible").style("top",function(){return h<450||f?"0px":"race"==et?yt(x("supWhite",e.value))+st+"px":yt(x("supGender",e.value))+st+"px"}).style("left",function(){return h<450||f?"0px":"race"==et?gt(x("raceStaff",e.value))+e.value.radius+ot+"px":gt(x("genderStaff",e.value))+e.value.radius+ot+"px"}))}function r(e,a){_t.style("visibility",null),"swarm"==t||"new"==t?a.style("stroke",function(t){var e=x(et,t.value);return+t.key==B?X:t.key==dt?d3.color(ie(e)).darker(u):d3.color(ie(e)).darker(1)}):"swarm-scatter"==t&&a.style("stroke",function(t){var e=x(et,t.value);return+t.key==B?X:t.key==dt?d3.color(ie(e)).darker(u):null})}var s=!1;"new"!=t&&"swarm"!=t?(L.style("visibility","visible").style("pointer-events","all"),Q!=t||"table"==t?(Q=t,s=!0):tt!=et?(tt=et,s=!0):s=!1):L.style("visibility",null).style("pointer-events",null);var i=[0,0,0],u=2;if(function(){var e="Newsroom <span>Gender</span> Breakdown";"race"==et&&(e=h>450?"Newsroom <span>White/Non-White</span> Breakdown vs. Audience":"Newsroom <span>Racial</span> Breakdown vs. Audience"),"swarm-scatter"==t?e="Newsroom <span>Leadership</span> vs. Staff":"arrow-scatter"==t?e="How Newsrooms <span>Changed, "+$+" - "+J+"</span><span class='chart-title-note'><span class='red'>*</span>Newsroom Uses 2017 Data</span>":"arrow-scatter-full"==t?e="How Newsrooms <span>Changed, "+$+" - "+J+"</span><span class='chart-title-note'><span class='red'>*</span>Newsroom Uses 2017 Data</span>":"table"==t&&(e="Individual Newsroom Demographics<span class='chart-title-note'><span class='red'>*</span>Newsroom Uses 2017 Data</span>"),Mt.html(e)}(),function(t){E="gender"==et?"swarm-scatter"==t?d3.extent(Ot,function(t){return x("genderStaff",t.value)}):d3.extent(Ot,function(t){return x("gender",t.value)}):d3.extent(Ot,function(t){return x("race",t.value)}),"swarm"==t||"new"==t?(pt={top:40,right:20,bottom:50,left:20},ft=1e3-pt.left-pt.right,ht=325-pt.top-pt.bottom,h<1e3&&(ft=h-pt.left-pt.right),(h<400||f)&&(ht=400-pt.top-pt.bottom),"race"==et?(gt.domain([-1,1]).range([0,ft]).clamp(!0),ne=d3.mean(Ot,function(t){return t.value.whiteDelta}),ie.domain([-1,0,1])):"gender"==et&&(ne=d3.mean(Ot,function(t){return x("gender",t.value)}),gt.domain([.2,.8]).range([0,ft]).clamp(!0),E[0]<.2&&gt.domain([E[0],.8]),E[1]>.8&&gt.domain([.2,E[1]]),E[0]<.2&&E[1]>.8&&gt.domain([E[0],E[1]]),ie.domain([.2,.5,.8]))):"swarm-scatter"==t?(S.classed("swarm-scatter-selected",!0),pt={top:0,right:20,bottom:60,left:20},ft=680-pt.left-pt.right,h<680&&(pt={top:30,right:20,bottom:60,left:20},ft=h-pt.left-pt.right),ht=575-pt.top-pt.bottom,h<680&&(ht=475-pt.top-pt.bottom),gt=d3.scaleLinear().domain([.2,.8]).range([0,ft]).clamp(!0),yt=d3.scaleLinear().domain([.2,.8]).range([ht,0]).clamp(!0),"race"==et?(gt.domain([0,.85]).range([0,ft]).clamp(!0),yt.domain([0,.85]).range([ht,0]).clamp(!0),ne=d3.mean(Ot,function(t){return x("raceStaff",t.value)}),oe=d3.mean(Ot,function(t){return x("supWhite",t.value)})):(gt=d3.scaleLinear().domain([.2,.8]).range([0,ft]).clamp(!0),yt=d3.scaleLinear().domain([.2,.8]).range([ht,0]).clamp(!0),E[0]<.2&&gt.domain([E[0],.8]),ne=d3.mean(Ot,function(t){return x("genderStaff",t.value)}),oe=d3.mean(Ot,function(t){return x("supGender",t.value)}))):"arrow-scatter"==t?(S.classed("arrow-scatter-selected",!0),pt={top:70,right:100,bottom:40,left:200},ft=950-pt.left-pt.right,h<950&&(pt={top:70,right:20,bottom:40,left:200},ft=h-pt.left-pt.right),h<450&&(pt={top:65,right:20,bottom:40,left:150},ft=h-pt.left-pt.right),ht=450-pt.top-pt.bottom,gt=d3.scaleLinear().domain([.2,.8]).range([0,ft]).clamp(!0),yt=d3.scaleLinear().domain([.2,.8]).range([ht,0]).clamp(!0),h<600&&(gt=d3.scaleLinear().domain([.25,.75]).range([0,ft]).clamp(!0),yt=d3.scaleLinear().domain([.25,.75]).range([ht,0]).clamp(!0)),"gender"==et&&(E[0]<.2?gt.domain([E[0],.8]):E[1]>.8?gt.domain([.2,E[1]]):E[1]>.8&&E[0]<.2&&gt.domain([E[0],E[1]])),"race"==et&&(gt.domain([-1,1]).range([0,ft]).clamp(!0),ne=d3.mean(Ot,function(t){return t.value.whiteDelta}),ie.domain([-1,0,1]),h<820&&gt.domain([-1,0]).range([0,ft]).clamp(!0))):"arrow-scatter-full"==t?(pt={top:70,right:150,bottom:40,left:150},ft=950-pt.left-pt.right,h<950&&(S.classed("arrow-scatter-full-selected",!0),pt={top:70,right:50,bottom:40,left:50},ft=h-pt.left-pt.right),h<400&&(S.classed("arrow-scatter-full-selected",!1),pt={top:50,right:50,bottom:40,left:10},ft=h-pt.left-pt.right),h<700&&"race"==et&&(pt={top:50,right:10,bottom:40,left:10},ft=h-pt.left-pt.right),ht=450-pt.top-pt.bottom,gt=d3.scaleLinear().domain([.2,.8]).range([0,ft]).clamp(!0),yt=d3.scaleLinear().domain([.2,.8]).range([ht,0]).clamp(!0),"gender"==et&&(E[0]<.2?gt.domain([E[0],.8]):E[1]>.8?gt.domain([.2,E[1]]):E[1]>.8&&E[0]<.2&&gt.domain([E[0],E[1]])),re=d3.mean(Ot,function(t){return"n/a"==t.value.previousYear?null:t.value.previousYear}),ne=d3.mean(Ot,function(t){return t.value.currentYear}),"race"==et&&(gt.domain([-1,1]).range([0,ft]).clamp(!0),h<700&&gt.domain([-1,.35]).range([0,ft]).clamp(!0),h<450&&gt.domain([-.75,.35]).range([0,ft]).clamp(!0),re=d3.mean(Ot,function(t){var e=x("race-old",t.value);return"n/a"==e?null:e}),ne=d3.mean(Ot,function(t){return t.value.whiteDelta}),ie.domain([-1,0,1]))):"table"==t&&(h<700&&(S.classed("table-selected",!0),pt={top:70,right:50,bottom:40,left:50},ft=h-pt.left-pt.right),xt.transition().duration(0).style("opacity",1),pt={top:40,right:20,bottom:20,left:20},ft=1e3-pt.left-pt.right,ht=250-pt.top-pt.bottom,""!=y&&(ht=210-pt.top-pt.bottom),h<1e3&&(pt={top:40,right:20,bottom:20,left:20},ft=h-pt.left-pt.right),h<700&&(pt={top:160,right:20,bottom:20,left:20},ft=h-pt.left-pt.right,ht=280-pt.top-pt.bottom,console.log(y),""!=y&&(console.log("here"),ht=210-pt.top-pt.bottom)),h<450&&(pt={top:160,right:20,bottom:20,left:20},ft=h-pt.left-pt.right,ht=210-pt.top-pt.bottom),gt=d3.scaleLinear().domain([.2,.8]).range([0,ft]).clamp(!0),yt=d3.scaleLinear().domain([.2,.8]).range([ht,0]).clamp(!0),jt.range([4,27]),T.style("visibility","hidden"),A.style("display","block")),"table"!=t&&"new"!=t&&(jt.range([4,27]),A.style("display",null),T.style("visibility",null),xt.transition().duration(0).style("opacity",0)),"arrow-scatter"!=t&&"arrow-scatter-full"!=t&&"new"!=t&&fe.transition().duration(0).style("opacity",0),"arrow-scatter"!=t&&"new"!=t&&(pe.transition().duration(0).style("opacity",0),le.style("opacity",null),de.transition().duration(0).style("opacity",0)),"arrow-scatter-full"!=t&&"new"!=t&&(de.style("transform",null),he.style("opacity",0)),"swarm-scatter"==t||"arrow-scatter"==t||"arrow-scatter-full"==t?H.classed("search-results-top-shift",!0):"new"!=t&&H.classed("search-results-top-shift",!1),h>450?Mt.transition().duration(500).style("width",ft+"px").style("left","0px").style("text-align",null):"table"==t?Mt.transition().duration(500).style("width","90%").style("left","0px").style("text-align","center"):Mt.transition().duration(500).style("width","90%").style("left","0px").style("text-align",null),"swarm-scatter"!=t&&"new"!=t&&S.classed("swarm-scatter-selected",!1),"arrow-scatter"!=t&&"new"!=t&&S.classed("arrow-scatter-selected",!1),"arrow-scatter-full"!=t&&"new"!=t&&S.classed("arrow-scatter-full-selected",!1),"table"!=t&&"new"!=t&&S.classed("table-selected",!1),"new"==t||("arrow-scatter-full"==t||"arrow-scatter"==t?j.style("pointer-events",function(t){return"n/a"==x("gender-old",t.value)?"none":null}).text(function(t){return"n/a"==x("gender-old",t.value)?"(Unavail: No 2001 Data) "+t.value.companyName.replace(/\b\w/g,function(t){return t.toUpperCase()}):t.value.companyName.replace(/\b\w/g,function(t){return t.toUpperCase()})}):j.style("pointer-events",null).text(function(t){return t.value.companyName.replace(/\b\w/g,function(t){return t.toUpperCase()})})),wt.transition().duration(ge).style("width",ft+pt.left+pt.right+"px"),_t.attr("transform","translate("+pt.left+","+pt.top+")"),bt.transition().duration(ge).attr("height",ht+pt.top+pt.bottom).attr("width",ft+pt.left+pt.right),ve.transition().duration(500).attr("transform","translate("+pt.left+","+pt.top+")"),me.transition().duration(500).attr("transform","translate("+pt.left+","+pt.top+")")}(t),"swarm-scatter"==t){var d=function(){var t=me.append("g"),e=t.append("g");e.append("g").attr("class","swarm-scatter-rect-gender-g").append("line").attr("class","swarm-scatter-rect-gender-line").attr("x1",0).attr("x2",ft).attr("y1",function(t){return ht/2}).attr("y2",function(t){return ht/2}).style("visibility",function(){return"race"==et?"hidden":null}),e.append("g").attr("class","swarm-scatter-x-axis-lines").selectAll("line").data(function(){return"race"==et?[.1,.3,.5,.7]:[.25,.35,.45,.55,.65,.75]}).enter().append("line").attr("x1",function(t){return gt(t)}).attr("x2",function(t){return gt(t)}).attr("y1",0).attr("y2",ht).attr("class","swarm-axis-line"),e.append("g").attr("class","swarm-scatter-y-axis-lines").selectAll("line").data(function(){return"race"==et?[.1,.3,.5,.7]:[.3,.5,.4,.6,.7]}).enter().append("line").attr("x1",0).attr("x2",ft).attr("y1",function(t){return yt(t)}).attr("y2",function(t){return yt(t)}).attr("class","swarm-axis-line");var a=t.append("g");a.append("g").selectAll("text").data(function(){return h<450?"race"==et?["← More White","Staff Race","More Non-white →"]:["← More Male Staff","Staff Gender","More Female Staff →"]:"race"==et?["← More White","Staff Race","More People of Color →"]:["← More Male Staff","Staff Gender","More Female Staff →"]}).enter().append("text").attr("x",function(t,e){return 0==e?0:1==e?ft/2:ft}).attr("y",function(t,e){return ht}).attr("class",function(t,e){return 1!=e?"swarm-axis-tick-text scatter-axis-chart-text scatter-axis-chart-side":"swarm-axis-tick-text scatter-axis-chart-text"}).text(function(t){return t}).style("text-anchor",function(t,e){return 0==e?"start":1!=e?"end":"middle"}),a.append("g").selectAll("text").data(function(){return"race"==et?[{text:"75% Leaders are Not White",value:.75},{text:"Leaders: 50-50 White/Non-White",value:.5},{text:"25% Non-White",value:.25},{text:"0% Non-White Leaders",value:0}]:[{text:"75% Leaders are Women",value:.75},{text:"65% Female",value:.65},{text:"Leaders: 50-50 Male/Female",value:.5},{text:"35% Female",value:.35},{text:"25% Leaders are Female",value:.25}]}).enter().append("text").attr("transform","translate("+(ft-10)+",0)").attr("y",function(t,e){return yt(t.value)}).attr("class",function(t,e){return"swarm-axis-tick-text scatter-axis-chart-text-y"}).style("text-anchor",function(t,e){return"end"}).text(function(t){return t.text}).attr("dy",0).call(o,95)};ue=le.selectAll(".swarm-circle").on("mouseover",function(t){a(t,d3.select(this))}).on("mouseout",function(t){r(t,d3.select(this))}),ue.transition().duration(ge).delay(function(t,e){return""!=v?0:10*e}).style("opacity",1).attr("cx",function(t){return gt("race"==et?x("raceStaff",t.value):x("genderStaff",t.value))}).attr("r",function(t){return t.value.radius}).attr("cy",function(t){return yt("race"==et?x("supWhite",t.value):x("supGender",t.value))}).style("fill",function(t){return+t.key==B?X:null}).style("stroke",function(t){var e=x(et,t.value);return+t.key==B?X:+t.key==dt?d3.color(ie(e)).darker(u):null}).style("stroke-width",function(t){return t.key==dt?"2px":null}).each(function(t){if(t.key==dt){var e=(d3.select(this),0),a=0;e=yt("race"==et?x("supWhite",t.value):x("supGender",t.value)),a=gt("race"==et?x("raceStaff",t.value):x("genderStaff",t.value)),i=[a,e,t.value.radius]}}),ue.filter(function(t){return+t.key==B}).style("stroke-opacity",.5).style("z-index",1e9).transition("border").duration(1e3).style("stroke-width","10px").transition("border").duration(1e3).style("stroke-width","1px").style("stroke-opacity",1),ce=le.selectAll(".swarm-image-container"),ce.transition().duration(ge).style("opacity",1).attr("transform",function(t){return"race"==et?"translate("+gt(x("raceStaff",t.value))+","+yt(x("supWhite",t.value))+")":"translate("+gt(x("genderStaff",t.value))+","+yt(x("supGender",t.value))+")"}),me.select("g").transition().duration(250).style("opacity",0).on("end",function(t){d3.select(this).remove(),d()}),function(){bt.select(".swarm-average").remove(),bt.select(".swarm-annnotation").remove();var t=ue.data().map(function(t){return"race"==et?x("raceStaff",t.value):x("genderStaff",t.value)}),e=ue.data().map(function(t){return"race"==et?x("supWhite",t.value):x("supGender",t.value)}),a=function(t,e){var a=function(t,e){return t+e},r=1*t.reduce(a)/t.length,n=1*e.reduce(a)/e.length,o=t.map(function(t){return Math.pow(t-r,2)}).reduce(a),s=e.map(function(t){return Math.pow(t-n,2)}).reduce(a),i=t.map(function(t,a){return(t-r)*(e[a]-n)}).reduce(a),l=i/o;return{slope:l,intercept:n-r*l,r2:Math.pow(i,2)/(o*s)}}(t,e),r=bt.append("g").attr("transform","translate("+pt.left+","+pt.top+")").attr("class","swarm-average"),o=r.append("g").attr("class","swarm-annnotation");r.append("line").attr("class","swarm-scatter-regression-line").attr("x1",0).attr("y1",yt(a.intercept)).attr("x2",function(t){return gt("race"==et?.85:.85)}).attr("y2",function(){return yt("race"==et?.85*a.slope+a.intercept:.85*a.slope+a.intercept)});var s=o.append("g").attr("class","swarm-scatter-regression-annotation").attr("transform",function(){return"translate("+gt(.8*.8)+","+yt(.8*.8*a.slope+a.intercept)+")"});s.append("text").attr("class","swarm-scatter-regression-annotation-text").text(function(){return"race"==et?"Newsrooms with racially diverse leadership tend to have a racially diverse staff":"Newsrooms with female leadership tend to have more women on staff"}).attr("transform","translate(-40,-55)").attr("dy",0).call(n,250),s.append("line").attr("class","swarm-scatter-regression-annotation-line").attr("x1",-35).attr("y1",-35).attr("x2",-5).attr("y2",-5).attr("marker-end","url(#arrow-head-black)");var l=r.append("g").attr("transform","translate("+i[0]+","+i[1]+")");l.append("line").attr("class","swarm-axis-annotation-line").attr("x1",i[2]).attr("x2",i[2]+150).attr("y1",0).attr("y2",0).style("stroke","#555555"),l.append("text").text(function(t){return ct.get(dt).Company}).attr("class","swarm-axis-annotation-text").attr("x",i[2]+150).style("text-anchor","start"),o.append("line").attr("x1",20).attr("x2",20).attr("y1",function(){return yt("race"==et?.7:.75)}).attr("y2",15).attr("class","swarm-annnotation-line").attr("marker-end",function(t){return"url(#arrow-head)"}),o.append("text").style("transform",function(){if("race"==et){var t="translate(20px,"+(yt(.7)+10)+"px) rotate(270deg)";return t}var t="translate(20px,"+(yt(.75)+10)+"px) rotate(270deg)";return t}).attr("class","swarm-annnotation-text swarm-scatter-y-annnotation-text").text(function(t){return"race"==et?"People of Color Leadership":"Women Leaders"}),console.log("2388"),r.append("circle").attr("class","swarm-circle swarm-circle-average").attr("cx",gt(ne)).attr("cy",function(t){return yt(oe)}).attr("r",6),r.append("text").attr("class","swarm-average-text swarm-average-text-label").attr("x",gt(ne)).attr("y",yt(oe)-12).style("fill","black").text("Average")}()}else if("swarm"==t){var p=function(){var t=me.append("g"),e=[.2,.3,.5,.7,.8];if(E[0]<.2||E[1]>.8)var e=[.2,.5,.8];var a=.5;"race"==et&&(e=[-1,-.5,-.25,0,.25,1],a=0),h<700&&(e=[.2,.5,.8],"race"==et&&(e=[-1,0,1],a=0));var r=t.append("g").attr("class","swarm-axis-tick-container").selectAll("g").data(e).enter().append("g").attr("class","swarm-axis-tick-g");r.append("line").style("stroke",function(t){return t==a?"#888":ie(t)}).attr("x1",function(t){return gt(t)}).attr("x2",function(t){return gt(t)}).attr("y1",function(t,e){return t==a?ht/2:0}).attr("y2",function(t){return t==a?0:.05*ht}).attr("class","swarm-axis-tick"),r.append("text").attr("x",function(t){return gt(t)}).attr("y",-9).attr("class","swarm-axis-tick-text").style("text-anchor",function(t,a){return 0==a?"start":a==e.length-1?"end":null}).style("fill",function(t,e){return t==a?"#888":ie(t)}).text(function(t,r){return 0==r?"race"==et?h<450?"+"+Math.floor(100*Math.abs(t))+" pts. White":"More White vs. City* Census":Math.floor(100*(1-t))+"% Male Staff":r==e.length-1?"race"==et?h<450?"+"+Math.floor(100*Math.abs(t))+" pts. Non-white":"More People of Color vs. City* Census":Math.floor(100*t)+"% Female Staff":t==a?"race"==et?"Parity with City*":"50/50  Split":t<a?"race"==et?"+"+Math.floor(100*Math.abs(t))+" pts.":Math.floor(100*(1-t))+"%":"race"==et?"+"+Math.floor(100*Math.abs(t))+" pts.":Math.floor(100*t)+"%"}),t.append("g").append("line").attr("x1",0).attr("x2",ft).attr("y1",ht/2).attr("y2",ht/2).attr("class","swarm-axis-line")},g=d3.forceCollide().radius(function(t){return t.value.radius+1}).iterations(1),w=d3.forceSimulation(Ot).force("x",d3.forceX(function(t){return gt(x(et,t.value))}).strength(1)).force("y",d3.forceY(ht/2)).force("collide",g).stop();me.select("g").transition().duration(500).style("opacity",0).on("end",function(t){d3.select(this).remove(),p()});for(var k=0;k<250;++k)w.tick();le.each(function(t){t.key==dt&&(i=[t.x,t.y,t.value.radius])}),ue=le.selectAll(".swarm-circle").on("mouseover",function(t){a(t,d3.select(this))}).on("mouseout",function(t){r(t,d3.select(this))}),ue.transition().duration(ge).style("opacity",1).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).style("fill",function(t){if(+t.key==B)return X;var e=x(et,t.value);return ie(e)}).attr("r",function(t){return t.value.radius}).style("stroke",function(t){var e=x(et,t.value);return+t.key==B?X:t.key==dt?d3.color(ie(e)).darker(u):d3.color(ie(e)).darker(1)}).style("stroke-width",function(t){return t.key==dt?"2px":null}),ue.filter(function(t){return+t.key==B}).style("stroke-opacity",.5).transition("border").duration(1e3).style("stroke-width","10px").transition("border").duration(1e3).style("stroke-width","1px").style("stroke-opacity",1),ce=le.selectAll(".swarm-image-container"),ce.transition().duration(ge).style("opacity",1).attr("transform",function(t){return"translate("+t.x+","+t.y+")"}),function(){bt.select(".swarm-average").remove(),bt.select(".swarm-annnotation").remove();var t=bt.append("g").attr("transform","translate("+pt.left+","+pt.top+")").attr("class","swarm-annnotation");if(!f&&h>550){var e=0;h<650&&(e=100),t.append("line").attr("x1",ft-147+e).attr("x2",ft-10).attr("y1",ht/2+25).attr("y2",ht/2+25).attr("class","swarm-annnotation-line").attr("marker-end",function(t){return"url(#arrow-head)"}),t.append("text").attr("x",ft-147+e).attr("y",ht/2+25).attr("class","swarm-annnotation-text").text(function(t){return"race"==et?"More People of Color":"More Women"})}var a=bt.append("g").attr("transform","translate("+pt.left+","+pt.top+")").attr("class","swarm-average").style("opacity",0),r=ht-i[1],n=a.append("g").attr("transform","translate("+i[0]+","+i[1]+")");n.append("line").attr("class","swarm-axis-annotation-line").attr("x1",0).attr("x2",0).attr("y1",i[2]).attr("y2",r).style("stroke","#555555"),n.append("text").text(ct.get(dt).Company).attr("class","swarm-axis-annotation-text").attr("y",r+10),a.append("text").attr("class","swarm-average-text swarm-average-text-label").attr("x",gt(ne)).attr("y",.2*ht-22).text("Average"),a.append("text").attr("class","swarm-average-text").attr("x",gt(ne)).attr("y",.2*ht-7).text(function(){return"race"==et?Math.round(100*Math.abs(ne))+" pts. over-represented white":Math.round(100*(1-ne))+"% Male"}),a.append("line").attr("class","swarm-average-line").attr("x1",gt(ne)).attr("x2",gt(ne)).attr("y1",.2*ht).attr("y2",.8*ht),a.transition().duration(ge).delay(ge).style("opacity",1)}()}else if("new"==t){for(var g=d3.forceCollide().radius(function(t){return t.value.radius+1}).iterations(1),w=d3.forceSimulation(Ot).force("x",d3.forceX(function(t){return gt(x(et,t.value))}).strength(1)).force("y",d3.forceY(ht/2)).force("collide",g).stop(),k=0;k<250;++k)w.tick();le=ve.selectAll("g").data(Ot).enter().append("g").attr("class","swarm-cell-g"),fe=le.append("path").attr("class","swarm-line"),console.log("3071"),pe=le.append("circle").attr("class","swarm-circle-two").attr("r",function(t){return 4}).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}),console.log("3085"),ue=le.append("circle").attr("class","swarm-circle").attr("r",function(t){return t.value.radius}).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).on("mouseover",function(t){a(t,d3.select(this))}).on("mouseout",function(t){r(t,d3.select(this))}).style("fill",function(t){if(+t.key==B)return X;var e=x(et,t.value);return ie(e)}).style("stroke",function(t){var e=x(et,t.value);return+t.key==B?X:t.key==dt?d3.color(ie(e)).darker(u):d3.color(ie(e)).darker(1)}),ce=le.append("g").attr("transform",function(t,e){return"translate("+t.x+","+t.y+")"}).attr("class","swarm-image-container"),ce.append("image").attr("class","swarm-image").attr("xlink:href",function(t){return"Newsday (Long Island)"==t.value.companyName?"assets/newsday-logo.svg":"the new york times"==t.value.companyName?"assets/ny-times-logo.svg":"chicago tribune"==t.value.companyName?"assets/chicago-tribune-logo.svg":"the wall street journal"==t.value.companyName?"assets/wsj-logo.svg":"Los Angeles Times"==t.value.companyName?"assets/la-times.svg":"usa today"==t.value.companyName?"assets/usa-today-logo.svg":"the washington post"==t.value.companyName?"assets/wapo-logo.png":null}).attr("width",function(t){return 2*t.value.radius*.7}).attr("height",function(t){return 2*t.value.radius*.7}).attr("style",function(t){return"-webkit-transform: translate("+-1*t.value.radius*2*.7/2+"px,"+-1*t.value.radius*2*.7/2+"px); transform:translate("+-1*t.value.radius*2*.7/2+"px,"+-1*t.value.radius*2*.7/2+"px);"}),de=le.append("text").attr("x",function(t,e){return t.x}).attr("y",function(t,e){return t.y}).attr("class","swarm-text").style("opacity",0).attr("class","swarm-text").text(function(t){return t.value.companyName.replace(/\b\w/g,function(t){return t.toUpperCase()})}),de.filter(function(t){return-1==N.indexOf(+t.key)}).append("tspan").attr("dx",2).text(function(t){return"*"}),he=le.append("line").attr("class","swarm-text-dash").style("opacity",0),D=mt.append("div").attr("class","footer-container").append("div").attr("class","footer-wrapper"),D.append("div").attr("class","news-lab-logo").append("p").html("*60 of 670 newsrooms are compared to a geography larger than a city, (e.g., USA Today: USA. Boston Globe: Massachusetts). Geographies were approximated using public data.");var C=D.append("div").attr("class","embed-link");I=C.append("p").append("span").attr("class","embed-link-text").text("Embed This Chart").on("click",function(t){d3.select(this).text("Paste code into your site"),O.style("display","block").attr("readonly",!0).attr("value",function(t){return"<iframe src='https://googletrends.github.io/asne/index.html?view="+it.indexOf(Z)+"&filter="+et+"' frameborder='0'></iframe>"})}),O=C.append("input"),d3.select(".note-new-data").on("click",function(t){d3.select(".footer-highlight").classed("footer-highlighted",!0),document.getElementById("footer-element").scrollIntoView()}),D.append("div").attr("class","swarm-chart-source").attr("id","footer-element").selectAll("p").data(["Source: ASNE, Census: &lsquo;11-&lsquo;15","American Community Survey.","Newsrooms shown are those","with 25 total staff or more","<span class='note-new-data-footer'>*</span>About two-thirds of newsrooms did not respond to the 2018 survey and use data from 2017. This year’s respondents are here."]).enter().append("p").attr("class","swarm-chart-source-text").style("margin-top",function(t,e){return 1==e||4==e?"10px":null}).classed("footer-highlight",function(t,e){return 4==e}).html(function(t){return t}),window.addEventListener("click",function(t){document.getElementById("search-results-box").contains(t.target)||(_t.style("visibility",null),H.style("display",null))}),window.addEventListener("touchstart",function(t){document.getElementById("search-results-box").contains(t.target)||(_t.style("visibility",null),H.style("display",null))}),b(),M(),function(){var t=me.append("g"),e=[.2,.3,.5,.7,.8],a=.5;"race"==et&&(e=[-1,-.5,-.25,0,.25,1],h<750&&(e=[-1,-.25,0,.25,1]),a=0),h<700&&(e=[.2,.5,.8],"race"==et&&(e=[-1,0,1],a=0));var r=t.append("g").attr("class","swarm-axis-tick-container").selectAll("g").data(e).enter().append("g").attr("class","swarm-axis-tick-g");r.append("line").style("stroke",function(t){return t==a?"#888":ie(t)}).attr("x1",function(t){return gt(t)}).attr("x2",function(t){return gt(t)}).attr("y1",function(t,e){return t==a?ht/2:0}).attr("y2",function(t){return t==a?0:.05*ht}).attr("class","swarm-axis-tick"),r.append("text").attr("x",function(t){return gt(t)}).attr("y",-9).attr("class","swarm-axis-tick-text").style("text-anchor",function(t,a){return 0==a?"start":a==e.length-1?"end":null}).style("fill",function(t,e){return t==a?"#888":ie(t)}).text(function(t,r){return 0==r?"race"==et?h<750?"+"+Math.floor(100*Math.abs(t))+" pts. White":"More White vs. City* Census":Math.floor(100*(1-t))+"% Male Staff":r==e.length-1?"race"==et?h<750?"+"+Math.floor(100*Math.abs(t))+" pts. Non-white":"More People of Color vs. City* Census":Math.floor(100*t)+"% Female Staff":t==a?"race"==et?"Parity with City*":"50/50  Split":t<a?"race"==et?"+"+Math.floor(100*Math.abs(t))+" pts.":Math.floor(100*(1-t))+"%":"race"==et?"+"+Math.floor(100*Math.abs(t))+" pts.":Math.floor(100*t)+"%"}),t.append("g").append("line").attr("x1",0).attr("x2",ft).attr("y1",ht/2).attr("y2",ht/2).attr("class","swarm-axis-line")}(),function(){bt.select(".swarm-average").remove(),bt.select(".swarm-annnotation").remove();var t=bt.append("g").attr("transform","translate("+pt.left+","+pt.top+")").attr("class","swarm-annnotation");if(!f&&h>550){var a=0;h<650&&(a=100),t.append("line").attr("x1",ft-147+a).attr("x2",ft-10).attr("y1",ht/2+25).attr("y2",ht/2+25).attr("class","swarm-annnotation-line").attr("marker-end",function(t){return"url(#arrow-head)"}),t.append("text").attr("x",ft-147+a).attr("y",ht/2+25).attr("class","swarm-annnotation-text").text(function(t){return"race"==et?"More People of Color":"More Women"})}var r=bt.append("g").attr("transform","translate("+pt.left+","+pt.top+")").attr("class","swarm-average");r.append("text").attr("class","swarm-average-text swarm-average-text-label").attr("x",gt(ne)).attr("y",.2*ht-22).text("Average"),r.append("text").attr("class","swarm-average-text").attr("x",gt(ne)).attr("y",.2*ht-7).text(function(){return"race"==et?Math.round(100*Math.abs(ne))+" pts. over-represented white":Math.round(100*(1-ne))+"% Male"}),r.append("line").attr("class","swarm-average-line").attr("x1",gt(ne)).attr("x2",gt(ne)).attr("y1",.2*ht).attr("y2",.8*ht),(0,c.default)(function(t,a){var n=[];if(a={ip:"24.194.26.74",country_code:"US",country_name:"United States",region_code:"CA",region_name:"Massachusetts",city:"Boston",zip_code:"01230",time_zone:"America/New_York",latitude:42.3601,longitude:-71.0589,metro_code:532},le.each(function(t){if(t.value.hasLocation&&null!=a){var e=t.value.location;l.default.getDistanceSimple(a,e)<2e5&&n.push(t)}}),n.length>1&&(n=n.sort(function(t,e){return+e.value.maxTotal-+t.value.maxTotal}).filter(function(t){return["nj","ny","ct"].indexOf(a.region_code.toLowerCase())>-1?t:t.value.companyData.State==a.region_code.toLowerCase()}),n=n.slice(0,m)),0!=n.length){lt=n,dt=+n[0].key,i=[n[0].x,n[0].y,n[0].value.radius];var o=ht-i[1],s=r.append("g").attr("transform","translate("+i[0]+","+i[1]+")");s.append("line").attr("class","swarm-axis-annotation-line").attr("x1",0).attr("x2",0).attr("y1",i[2]).attr("y2",o).style("stroke","#555555"),s.append("text").text(ct.get(dt).Company).attr("class","swarm-axis-annotation-text").attr("y",o+10),ue.each(function(t,a,r){+t.key==dt&&e(d3.select(this))})}else lt=Ot.slice(0,m);""!=v&&0!=+v&&(Z=it[v],_(Z))})}()}else if("arrow-scatter"==t){var R=function(t,e,a){return e>t?"M"+(e-6)+","+a+" L"+(e-12)+","+(a+4)+" L"+(e-12)+","+(a+1.5)+" L"+t+","+a+" L"+(e-12)+","+(a-1.5)+" L"+(e-12)+","+(a-4)+" L"+(e-6)+","+a:"M"+(e+6)+","+a+" L"+(e+12)+","+(a+4)+" L"+(e+12)+","+(a+1.5)+" L"+t+","+a+" L"+(e+12)+","+(a-1.5)+" L"+(e+12)+","+(a-4)+" L"+(e+6)+","+a},P=function(){var t=me.append("g"),e=t.append("g"),a=[.2,.35,.5,.65,.8];if("race"==et&&(a=[-1,-.25,0,.25,1]),h<820){var a=[.25,.5,.75];"race"==et&&(a=[-1,0])}e.append("g").attr("class","swarm-arrow-x-axis-lines").selectAll("line").data(a).enter().append("line").attr("x1",function(t){return gt(t)}).attr("x2",function(t){return gt(t)}).attr("y1",-10).attr("y2",z*K).attr("class","swarm-axis-line").style("stroke",function(t,e){return.5==t?"rgba(0, 0, 0, 0.09)":null}).style("stroke-width",function(t,e){return.5==t?"2px":null}),e.append("g").attr("class","swarm-scatter-y-axis-lines").selectAll("line").data(d3.range(z)).enter().append("line").attr("x1",function(t,e){return 0==e||e==F?-140:-15}).attr("x2",ft+15).attr("y1",function(t,e){return e*K}).attr("y2",function(t,e){return e*K}).attr("class","swarm-axis-line"),t.append("g").append("g").selectAll("text").data(a).enter().append("text").attr("x",function(t,e){return gt(t)}).attr("y",function(t,e){return 0}).attr("class",function(t,e){return"swarm-arrow-tick-text"}).style("text-anchor",function(t,e){return 0==e?"start":1==t&&"race"==et?"end":.75==t&&h<651?"end":.8==t?"end":h<820&&"race"==et?"end":null}).text(function(t,e){return 0==e?"race"==et?h<820?"+"+Math.floor(100*Math.abs(t))+" pts. white":"More White vs. City* Census":Math.floor(100*(1-t))+"% Male":0==t&&"race"==et?h<820?"Parity w/Census":"Parity with Census":t<.5?"race"==et?"+"+Math.floor(100*Math.abs(t))+" pts.":Math.floor(100*(1-t))+"%":.5==t&&"race"!=et?"50/50 Split":.75==t&&h<651?Math.floor(100*t)+"% Female":.8==t?Math.floor(100*t)+"% Female":1==t&&"race"==et?h<820?"+"+Math.floor(100*Math.abs(t))+" pts. more non-white vs. census":"More People of Color vs. City* Census":"race"==et?"+"+Math.floor(100*Math.abs(t))+" pts.":Math.floor(100*t)+"%"})},G=ge,Y=!1,F=0;s||(G=0);var U,K=15,V=le.filter(function(t){return t.value.miniChart>-1||t.key==B}).sort(function(t,e){return"race"==et?e.value.raceDiff-t.value.raceDiff:e.value.diff-t.value.diff}).each(function(t,e){t.value.arrowSort=e,t.value.diff<0&&"race"!=et&&(Y||(Y=!0,F=e+2),t.value.arrowSort=e+2),t.value.raceDiff<0&&"race"==et&&(Y||(Y=!0,F=e+2),t.value.arrowSort=e+2),0==e&&(U=t)}),z=V.size()+2,q=500;le.filter(function(t){return-1==t.value.miniChart&&t.key!=B}).style("opacity",0),ue=le.selectAll(".swarm-circle").on("mouseover",function(t){}).on("mouseout",function(t){}),ue.filter(function(t){return t.value.miniChart>-1||t.key==B}).style("opacity",1).style("fill",null).style("stroke",null).transition().duration(G).attr("r",4).attr("cx",function(t){return gt("race"==et?x("race",t.value):x("gender",t.value))}).attr("cy",function(t,e){return t.value.arrowSort*K+K/2}),ce=le.selectAll(".swarm-image-container"),ce.filter(function(t){return t.value.miniChart>-1||t.key==B}).transition().duration(ge).style("opacity",0),de=le.selectAll(".swarm-text"),de.style("text-anchor",null).style("fill",function(t){return+t.key==dt?"black":null}).style("font-weight",function(t){return+t.key==dt?600:null}).filter(function(t){return t.value.miniChart>-1||t.key==B}).style("opacity",null).transition().duration(G).attr("x",function(t){return 0}).attr("y",function(t,e){return t.value.arrowSort*K+K/2});pe=le.selectAll(".swarm-circle-two").on("mouseover",function(t){}).on("mouseout",function(t){}),pe.filter(function(t){return t.value.miniChart>-1||t.key==B}).attr("r",4).attr("cx",function(t){if("race"==et){var e=x("race-old",t.value);return"n/a"==e?null:gt(e)}var e=x("gender-old",t.value);return"n/a"==e?null:gt(e)}).attr("cy",function(t,e,a){return t.value.arrowSort*K+K/2}).transition().duration(G).delay(function(t){return s?10*t.value.arrowSort+q:0}).style("opacity",1),de.filter(function(t){return t.key==B?t:null}).style("fill",X).style("font-weight",600).transition().duration(ge).style("font-size","15px").transition().duration(ge).style("font-size","11px"),pe.filter(function(t){return t.key==B?t:null}).transition().duration(ge).style("fill",X).style("stroke",X).transition().duration(ge).style("fill",null).style("stroke",null),ue.filter(function(t){return t.key==B?t:null}).transition().duration(ge).style("fill",X).style("stroke",X).transition().duration(ge).style("fill",null).style("stroke",null),fe=le.selectAll(".swarm-line"),fe.filter(function(t){return t.value.miniChart>-1||t.key==B}).transition().duration(0).attr("d",function(t){if("race"==et){gt(x("race-old",t.value)),gt(x("race-old",t.value));return Math.abs(t.value.raceDiff)<.02?"":t.value.raceDiff>.02?R(gt(x("race-old",t.value)),gt(x("race-old",t.value)+.02),t.value.arrowSort*K+K/2):R(gt(x("race-old",t.value)),gt(x("race-old",t.value)-.02),t.value.arrowSort*K+K/2)}gt(x("gender-old",t.value)),gt(x("gender-old",t.value));return Math.abs(t.value.diff)<.02?"":t.value.diff>.02?R(gt(x("gender-old",t.value)),gt(x("gender-old",t.value)+.02),t.value.arrowSort*K+K/2):R(gt(x("gender-old",t.value)),gt(x("gender-old",t.value)-.02),t.value.arrowSort*K+K/2)}).attr("fill",function(t){return t.value.raceDiff>0&&"race"==et?"url(#gradient-right)":t.value.diff>0&&"race"!=et?"url(#gradient-right)":"url(#gradient-left)"}).transition().duration(G).delay(function(t){return s?10*t.value.arrowSort+q+ge:0}).style("opacity",1).transition().duration(function(){return s?400:0}).delay(function(t,e){return s?15*t.value.arrowSort:0}).attrTween("d",function(t){if("race"==et){gt(x("race-old",t.value)),gt(x("race",t.value));return function(e){return Math.abs(t.value.raceDiff)<.02?"":t.value.raceDiff>.02?R(gt(x("race-old",t.value)),(gt(x("race",t.value))-gt(x("race-old",t.value)+.02))*e+gt(x("race-old",t.value)+.02),t.value.arrowSort*K+K/2):t.value.raceDiff<-.02?R(gt(x("race-old",t.value)),gt(x("race-old",t.value)-.02)-Math.abs(gt(x("race",t.value))-gt(x("race-old",t.value)-.02))*e,t.value.arrowSort*K+K/2):void 0}}gt(x("gender-old",t.value)),gt(x("gender",t.value));return function(e){return Math.abs(t.value.diff)<.02?"":t.value.diff>.02?R(gt(x("gender-old",t.value)),(gt(x("gender",t.value))-gt(x("gender-old",t.value)+.02))*e+gt(x("gender-old",t.value)+.02),t.value.arrowSort*K+K/2):t.value.diff<-.02?R(gt(x("gender-old",t.value)),gt(x("gender-old",t.value)-.02)-Math.abs(gt(x("gender",t.value))-gt(x("gender-old",t.value)-.02))*e,t.value.arrowSort*K+K/2):void 0}}),me.select("g").transition().duration(250).style("opacity",0).on("end",function(t){d3.select(this).remove(),P()}),function(){bt.select(".swarm-average").remove(),bt.select(".swarm-annnotation").remove();var t=bt.append("g").attr("transform","translate("+pt.left+","+pt.top+")").attr("class","swarm-average"),e=t.append("g").attr("class","swarm-annnotation"),a=["gender-old","gender"];"race"==et&&(a=["race-old","race"]);var r=e.append("g").selectAll("g").data(a).enter().append("g").attr("class","swarm-arrow-annotation-top").attr("transform",function(t,e){return"translate("+gt(x(t,U.value))+",0)"}).style("opacity",0);r.transition().duration(G).delay(function(t,e){return s&&0==e?q:0}).style("opacity",1);var n=["Gender Diversity Improved","Gender Diversity Dropped"];"race"==et&&(n=["Race Diversity Improved","Race Diversity Dropped"]);e.append("g").selectAll("text").data(n).enter().append("text").attr("class","swarm-arrow-annotation-left").attr("x",0).attr("y",function(t,e){return 0==e?0:K*F}).text(function(t){return t});r.append("text").attr("y",-30).attr("x",0).attr("class","swarm-arrow-annotation-top-text").style("fill",function(t){return"gender"==t?"#dab30b":"#888"}).style("text-anchor",function(t,e){return"race"==et?"race"==t?"start":"end":null}).text(function(t){return h<651?"gender"==t||"race"==t?"In "+J:"In "+$:"race"==et?"race"==t?"Race in "+J:"Race in "+$:"gender"==t?"Gender in "+J:"Gender in "+$}),r.append("line").attr("y1",0).attr("y2",-30).attr("x1",0).attr("x2",0).attr("class","swarm-arrow-annotation-top-line").style("stroke",function(t){return h<651?"black":"gender"==t?"#c1a427":"#888"})}()}else if("arrow-scatter-full"==t){var U,at=function(t,e,a){return e>t?"M"+(e-6)+","+a+" L"+(e-12)+","+(a+4)+" L"+(e-12)+","+(a+1.5)+" L"+t+","+a+" L"+(e-12)+","+(a-1.5)+" L"+(e-12)+","+(a-4)+" L"+(e-6)+","+a:"M"+(e+6)+","+a+" L"+(e+12)+","+(a+4)+" L"+(e+12)+","+(a+1.5)+" L"+t+","+a+" L"+(e+12)+","+(a-1.5)+" L"+(e+12)+","+(a-4)+" L"+(e+6)+","+a},nt=function(t,e,a){return"M"+(e-4)+","+a+" L"+(e-8)+","+(a+4)+" L"+(e-12)+","+(a+0)+" L"+(e-8)+","+(a-4)+" Z"},ut=function(t){if(+t.key==+At)return X;if("race"==et){if(Math.abs(t.value.raceDiff)<.03)return"#888";if(t.value.raceDiff>0)return"url(#gradient-blue)"}else{if(Math.abs(t.value.diff)<.02)return"#888";if(t.value.diff>0)return"url(#gradient-blue)"}return"url(#gradient-red)"},vt=function(){var t=me.append("g"),e=t.append("g"),a=[.2,.35,.5,.65,.8];"race"==et&&(a=[-1,-.25,0,.25,1],h<700&&(a=[-1,-.5,0,.35],h<450&&(a=[-.85,0,.35]))),e.append("g").attr("class","swarm-arrow-x-axis-lines").selectAll("line").data(a).enter().append("line").attr("x1",function(t){return gt(t)}).attr("x2",function(t){return gt(t)}).attr("y1",-10).attr("y2",z*K).attr("class","swarm-axis-line").style("stroke",function(t,e){return.5==t?"rgba(0, 0, 0, 0.09)":null}).style("stroke-width",function(t,e){return.5==t?"2px":null}),t.append("g").append("g").selectAll("text").data(a).enter().append("text").attr("x",function(t,e){return gt(t)}).attr("y",function(t,e){return 0}).attr("class",function(t,e){return"swarm-arrow-tick-text"}).style("text-anchor",function(t,e){return 0==e?"start":h<700&&"race"==et&&0==t?"end":1==t&&"race"==et?"end":.35==t&&"race"==et?"end":.8==t?"end":null}).text(function(t,e){return.35==t&&"race"==et?"+"+Math.floor(100*Math.abs(t))+" pts. Non-white":0==e?"race"==et?h<700?"+"+Math.floor(100*Math.abs(t))+" pts White":"More White vs. City* Census":Math.floor(100*(1-t))+"% Male":0==t&&"race"==et?h<750?"Parity w/census":"Parity with Census":t<.5?"race"==et?"+"+Math.floor(100*Math.abs(t))+" pts.":Math.floor(100*(1-t))+"%":.5==t&&"race"!=et?"50/50 Split":.8==t?Math.floor(100*t)+"% Female":1==t&&"race"==et?h<700?"+"+Math.floor(100*t)+" pts Non-white":"More People of Color vs. City* Census":"race"==et?"+"+Math.floor(100*Math.abs(t))+" pts.":Math.floor(100*t)+"%"})},K=3.5,kt=[],Nt=[],V=le.filter(function(t,e){return-1==rt.indexOf(+t.key)}).sort(function(t,e){return"race"==et?e.value.raceDiff-t.value.raceDiff:e.value.diff-t.value.diff}).each(function(t,e){"race"==et?(kt.push(t.value.raceDiff),Nt.push(x("race",t.value))):(kt.push(t.value.diff),Nt.push(x("gender",t.value))),t.value.arrowSort=e}),St=d3.extent(Nt),z=V.size(),q=ge+1e3;ue=le.selectAll(".swarm-circle"),ue.transition().duration(ge).style("opacity",0),ce=le.selectAll(".swarm-image-container"),ce.transition().duration(ge).style("opacity",0);de=le.selectAll(".swarm-text"),de.transition().duration(0).attr("x",function(t){return"n/a"==x("gender-old",t.value)?0:"race"==et?Math.abs(t.value.raceDiff)<.03?gt(x("race",t.value))+7:t.value.raceDiff>0?gt(x("race",t.value))+6:gt(x("race",t.value))-6:Math.abs(t.value.diff)<.02?gt(x("gender",t.value))+7:t.value.diff>0?gt(x("gender",t.value))+6:gt(x("gender",t.value))-6}).style("opacity",function(t,e,a){return"n/a"==x("gender-old",t.value)?0:h<600?0:"race"!=et||x("race",t.value)!=St[0]&&x("race",t.value)!=St[1]?x("gender",t.value)==St[0]||x("gender",t.value)==St[1]?1:0:1}).style("fill",function(t){return"n/a"==x("gender-old",t.value)?null:"race"==et?Math.abs(t.value.raceDiff)<.03?"#888":t.value.raceDiff>0?"blue":"red":Math.abs(t.value.diff)<.02?"#888":t.value.diff>0?"blue":"red"}).attr("y",function(t,e){return"n/a"==x("gender-old",t.value)?0:t.value.arrowSort*K}).style("text-anchor",function(t,e){if("n/a"==x("gender-old",t.value))return null;if("race"==et){if(Math.abs(t.value.raceDiff)<.03)return"start";if(t.value.raceDiff>0)return"start"}else{if(Math.abs(t.value.diff)<.02)return"start";if(t.value.diff>0)return"start"}return"end"}).style("transform","none"),he=le.selectAll(".swarm-text-dash"),he.style("opacity",function(t,e,a){return"n/a"==x("gender-old",t.value)?0:"race"==et?x("race",t.value)==St[0]||x("race",t.value)==St[1]?1:0:x("gender",t.value)==St[0]||x("gender",t.value)==St[1]?1:0}).attr("y1",function(t,e){return null}).attr("y2",function(t,e){return null}).attr("x1",function(t){return null}).attr("x2",function(t){return null}),fe=le.selectAll(".swarm-line");var At=B;fe.transition().duration(0).attr("d",function(t){if("n/a"==x("gender-old",t.value))return null;if("race"==et){var e=x("race-old",t.value);if("n/a"==e)return null;var a=gt(x("race-old",t.value)),r=gt(x("race",t.value));return Math.abs(t.value.raceDiff)<.03?nt(0,r,t.value.arrowSort*K):at(a,r,t.value.arrowSort*K)}var e=x("gender-old",t.value);if("n/a"==e)return null;var a=gt(e),r=gt(x("gender",t.value));return Math.abs(t.value.diff)<.02?nt(0,r,t.value.arrowSort*K):at(a,r,t.value.arrowSort*K)}).attr("fill",function(t){return ut(t)}).style("stroke","none").transition().duration(750).delay(function(t,e){return t.key==B?0:250+10*t.value.arrowSort}).style("opacity",function(t,e){return 1}).attr("transform",function(t){return t.key==B?"translate(0,"+-t.value.arrowSort*K+")":null}).transition().duration(750).attr("transform",function(t){return t.key==B?"translate(0,0)":null}),me.select("g").transition().duration(250).style("opacity",0).on("end",function(t){d3.select(this).remove(),vt()}),function(){bt.select(".swarm-average").remove(),bt.select(".swarm-annnotation").remove();var t=[0,0],e=bt.append("g").attr("transform","translate("+pt.left+","+pt.top+")").attr("class","swarm-average"),a=e.append("g").attr("class","swarm-annnotation");e.append("g").attr("class","arrow-swarm-full-mouseover").selectAll("rect").data(V.data()).enter().append("rect").attr("width",ft).attr("height",K).attr("x",function(t,e){return 0}).attr("y",function(t){return t.value.arrowSort*K-K/2}).attr("class","arrow-swarm-full-mouseover-rect").on("mouseover",function(t){s.style("opacity",.5),o.style("opacity",.5);var e=t.key;r.style("visibility","hidden"),de.style("opacity",function(t,a,r){return"n/a"==x("gender-old",t.value)?0:t.key==e?1:0}).style("fill",function(t){if(t.key==e)return"black";if("race"==et){if(Math.abs(t.value.raceDiff)<.02)return"#888";if(t.value.raceDiff>0)return"blue"}else{if(Math.abs(t.value.diff)<.02)return"#888";if(t.value.diff>0)return"blue"}return"red"}).style("font-size","14px"),he.style("opacity",function(t,a,r){return t.key==e?1:0}),fe.attr("fill",function(t){return t.key==e?"black":ut(t)}).style("stroke",function(t){return t.key==e?"black":"none"})}).on("mouseout",function(t){s.style("opacity",null),o.style("opacity",null),r.style("visibility",null),he.style("opacity",function(t,e,a){return"n/a"==x("gender-old",t.value)?0:"race"==et?x("race",t.value)==St[0]||x("race",t.value)==St[1]?1:0:x("gender",t.value)==St[0]||x("gender",t.value)==St[1]?1:0}),de.style("opacity",function(t,e,a){if("n/a"==x("gender-old",t.value))return 0;if("race"==et){if(h<700)return 0;if(x("race",t.value)==St[0]||x("race",t.value)==St[1])return 1}else if(x("gender",t.value)==St[0]||x("gender",t.value)==St[1])return 1;return 0}).style("fill",function(t){if("race"==et){if(Math.abs(t.value.raceDiff)<.02)return"#888";if(t.value.raceDiff>0)return"blue"}else{if(Math.abs(t.value.diff)<.02)return"#888";if(t.value.diff>0)return"blue"}return"red"}).style("font-size",null),fe.attr("fill",function(t){return ut(t)}).style("stroke",function(t){return"none"})});e.append("g").append("path").attr("class","arrow-scatter-line arrow-scatter-line-average").attr("d",function(t){var e=gt(re),a=gt(ne);return Math.abs(ne-re)<.02?nt(0,a,ht/2+20):at(e,a,ht/2+20)}).attr("fill",function(t){return ne-re>0?"url(#gradient-average)":"url(#gradient)"}).attr("stroke","none").attr("fill-opacity",1);var r=e.append("g").attr("class","arrow-scatter-average-text").attr("transform",function(t,e){return"translate("+gt(ne)+","+(ht/2+20)+")"}).append("text").attr("class","arrow-scatter-average-text-label").text(function(t){return"Average"});for(var n in kt)kt[n]>.02?t[0]=t[0]+1:kt[n]<-.02&&(t[1]=t[1]+1);var o=a.selectAll("text").data(t).enter().append("text").attr("class","swarm-arrow-full-annotation-diff").attr("transform",function(e,a){return"race"==et?h<700?h<600?0==a?"translate("+gt(-1)+","+ht*t[0]/z/2+")":"translate("+gt(-1)+","+ht*(1-t[1]/z/2)+")":0==a?"translate("+gt(0)+","+ht*t[0]/z/2+")":"translate("+gt(0)+","+ht*(1-t[1]/z/2)+")":0==a?"translate("+gt(.3)+","+ht*t[0]/z/2+")":"translate("+gt(.3)+","+ht*(1-t[1]/z/2)+")":0==a?"translate("+gt(.51)+","+ht*t[0]/z/2+")":"translate("+gt(.51)+","+ht*(1-t[1]/z/2)+")"}).style("fill",function(t,e){return 0==e?d3.color("blue"):d3.color("red")}).attr("x",0).attr("y",0).attr("dy",0).selectAll("tspan").data(function(t,e){return"race"==et?0==e?[Math.round(t/z*100)+"%"," of newsrooms ","gained","racial diversity, "+$+" - "+J]:[Math.round(t/z*100)+"%"," of newsrooms ","lost","racial diversity, "+$+" - "+J]:0==e?[Math.round(t/z*100)+"%"," of newsrooms ","gained","gender diversity, "+$+" - "+J]:[Math.round(t/z*100)+"%"," of newsrooms ","lost","gender diversity, "+$+" - "+J]}).enter().append("tspan").attr("x",function(t,e){return 3==e?"0":null}).attr("y",0).attr("dy",function(t,e){if(3==e)return"1.4em"}).text(function(t){return t}),s=e.append("g").attr("class","arrow-scatter-annoation-average").attr("transform",function(t,e){return"race"==et?h<700?h<600?"translate("+gt(-1)+","+(ht/2+20)+")":"translate("+gt(0)+","+(ht/2+20)+")":"translate("+gt(.3)+","+(ht/2+20)+")":"translate("+gt(.51)+","+(ht/2+20)+")"}).append("text").attr("class","arrow-scatter-annoation-average-text").text(function(t){return"race"==et?"Average: "+Math.round(1e3*(ne-re))/10+"pt. gain vs. census":ne-re>0?"Average: "+Math.round(1e3*(ne-re))/10+"% increase in women":"Average: "+Math.round(1e3*(ne-re))/10+"% increase in men"})}()}else if("table"==t){var Dt=function(){W=xt.selectAll("div").data(lt).enter().append("div").attr("class","swarm-chart-table-company-container"),W.transition().duration(500).delay(function(t,e){return 100*e}).style("opacity",1).style("transform","translate(0px,0px)"),W.append("p").attr("class","swarm-chart-table-company-name").html(function(t){var e=N.indexOf(+t.key),a="";return a="usa today"==t.value.companyName?"USA Today":t.value.companyName.length>30?t.value.companyName.replace(/\b\w/g,function(t){return t.toUpperCase()}).slice(0,27)+"...":t.value.companyName.replace(/\b\w/g,function(t){return t.toUpperCase()}),-1==e&&(a+="<span class='red'>*</span>"),a});var t=W.selectAll("div").data(function(t,e){var a=e,r=t;return["staff","leaders","census"].map(function(t){return{key:t,value:r,companyCount:a}})}).enter().append("div").attr("class","swarm-chart-table-company-section"),e=t.selectAll("div").data(function(t,e){var a=t,r=[J,+$];return"census"==a.key&&(r=[J]),r.map(function(t){return{year:t,key:a.key,value:a.value,companyCount:a.companyCount}})}).enter().append("div").attr("class","swarm-chart-table-company-row"),a=e.selectAll(".swarm-chart-table-company-percent").data(function(t,e){var a=t;return["white","black","hisp.","asian","female"].map(function(t){return{year:a.year,key:a.key,value:a.value,cat:t,companyCount:a.companyCount}})}).enter().append("p").attr("class","swarm-chart-table-company-percent").text(function(t){if("census"==t.key){if("female"==t.cat){var e=t.value.value.femaleCensus;return"n/a"==e?e:Math.round(100*t.value.value.femaleCensus)+"%"}if("white"==t.cat)return Math.round(100*t.value.value.whiteCensus)+"%";if("hisp."==t.cat&&t.year==J)return Math.round(100*t.value.value.hispanicCensus)+"%";if("black"==t.cat&&t.year==J)return Math.round(100*t.value.value.blackCensus)+"%";if("asian"==t.cat&&t.year==J)return Math.round(100*t.value.value.asianCensus)+"%"}if("staff"==t.key){if("white"==t.cat){if(t.year==J)return Math.round(100*x("white",t.value.value))+"%";var a=x("white-old",t.value.value);return"n/a"==a?a:Math.round(100*a)+"%"}if("black"==t.cat){if(t.year==J)return Math.round(100*x("black",t.value.value))+"%";var a=x("black-old",t.value.value);return"n/a"==a?a:Math.round(100*a)+"%"}if("hisp."==t.cat){if(t.year==J)return Math.round(100*x("hisp",t.value.value))+"%";var a=x("hisp-old",t.value.value);return"n/a"==a?a:Math.round(100*a)+"%"}if("asian"==t.cat){if(t.year==J)return Math.round(100*x("asian",t.value.value))+"%";var a=x("asian-old",t.value.value);return"n/a"==a?a:Math.round(100*a)+"%"}if("female"==t.cat){if(t.year==J)return Math.round(100*x("gender",t.value.value))+"%";var a=x("gender-old",t.value.value);return"n/a"==a?a:Math.round(100*a)+"%"}}if(t.key="leaders"){if("white"==t.cat){if(t.year==J)return Math.round(100*x("supWhiteRaw",t.value.value))+"%";var a=x("sup-white-old",t.value.value);return"n/a"==a?a:Math.round(100*a)+"%"}if("black"==t.cat){if(t.year==J)return Math.round(100*x("supBlack",t.value.value))+"%";var a=x("sup-black-old",t.value.value);return"n/a"==a?a:Math.round(100*a)+"%"}if("hisp."==t.cat){if(t.year==J)return Math.round(100*x("supHisp",t.value.value))+"%";var a=x("sup-hisp-old",t.value.value);return"n/a"==a?a:Math.round(100*a)+"%"}if("asian"==t.cat){if(t.year==J)return Math.round(100*x("supAsian",t.value.value))+"%";var a=x("sup-asian-old",t.value.value);return"n/a"==a?a:Math.round(100*a)+"%"}if("female"==t.cat){if(t.year==J)return Math.round(100*x("supGender",t.value.value))+"%";var a=x("sup-gender-old",t.value.value);return"n/a"==a?a:Math.round(100*a)+"%"}}return"tbd"});a.filter(function(t,e){return"census"==t.key&&t.year==J&&0==e}).append("span").attr("class","swarm-chart-table-company-row-top-label-census").text(function(t){return t.value.value.companyData.hasOverride?t.value.value.companyData.override.coverage_area.length>20?t.value.value.companyData.override.coverage_area.slice(0,17)+"...":t.value.value.companyData.override.coverage_area:t.value.value.companyData.City+", "+t.value.value.companyData.State.toUpperCase()}),e.filter(function(t,e){return"staff"==t.key&&t.year==J}).selectAll("p").append("span").attr("class","swarm-chart-table-company-row-top-label").text(function(t){return t.cat}),a.filter(function(t,e){return 0==e&&0==t.companyCount}).append("span").attr("class","swarm-chart-table-company-row-year").text(function(t){return"census"==t.key?"":t.year}),a.filter(function(t,e){return 0==e&&0==t.companyCount&&t.year==J}).append("span").attr("class",function(t,e){return"census"==t.key?"swarm-chart-table-company-row-key swarm-chart-table-company-row-census":"swarm-chart-table-company-row-key"}).text(function(t){return"census"==t.key?"audience":"staff"==t.key?"all":t.key}).filter(function(t){return"census"==t.key}).append("span").attr("class","swarm-chart-table-company-row-year-census-span").text("Latest Census Est.")};xt.selectAll(".swarm-chart-table-company-container").remove(),ue.on("mouseover",function(t){}).transition().duration(500).style("opacity",0),ce.transition().duration(500).style("opacity",0),s&&me.select("g").transition().duration(500).style("opacity",0).on("end",function(t){d3.select(this).remove();me.append("g");Dt()}),s&&function(){bt.select(".swarm-average").remove(),bt.select(".swarm-annnotation").remove();var t=bt.append("g").attr("transform","translate("+pt.left+","+pt.top+")").attr("class","swarm-average");t.append("g").attr("class","swarm-annnotation")}()}var Ct=B;B="",rt.push(Ct)}function b(){function t(){z=!0,A.classed("swarm-chart-min",!1),m.style("display","block"),v.style("display","none"),d.style("display","none"),w.style("pointer-events","all"),b.style("display","block")}function e(){z=!1,A.classed("swarm-chart-min",!0),m.style("display",null),v.style("display",null),w.style("pointer-events",null),b.style("display",null),d.style("display",null)}function a(t){console.log(t);var e=t,a=t.value.location,r=u([+a.longitude,a.latitude]);b.transition().duration(750).attr("transform","translate("+r+")");var n=[];M.each(function(t){if(t.value.hasLocation){var e=t.value.location;l.default.getDistanceSimple(a,e)<2e5&&n.push(t)}}),n=n.filter(function(t){return+t.key!=+e.key}),n.length>3&&(n=n.sort(function(t,e){return+e.value.maxTotal-+t.value.maxTotal}).slice(0,3)),lt=n,lt.unshift(t),(f||h<450)&&(lt=[t]),_("table")}function n(t,e){B=e,t.value.miniChart=-1,Ot.push(t),le=ve.selectAll("g").data(Ot,function(t){return+t.key});var a=le.enter().append("g").attr("class","swarm-cell-g");console.log("5549"),a.append("circle").attr("class","swarm-circle").attr("r",function(t){return t.value.radius}).attr("cx",function(t){return 0}).attr("cy",function(t){return 0}).on("mouseover",function(t){var e=t;mouseOverEvents(e,d3.select(this))}).on("mouseout",function(t){var e=t;mouseOutEvents(e,d3.select(this))}).style("fill",function(t){return}).style("stroke",function(t){var e=x("gender",t.value);return d3.color(ie(e)).darker(1)}).style("opacity",0),a.append("g").attr("transform",function(t,e){return"translate(0,0)"}).attr("class","swarm-image-container").append("image").attr("class","swarm-image").attr("xlink:href",function(t){return"the new york times"==t.value.companyName?"assets/ny-times-logo.svg":"the wall street journal"==t.value.companyName?"assets/wsj-logo.svg":"los angeles times"==t.value.companyName?"assets/la-times-logo.png":"usa today"==t.value.companyName?"assets/usa-today-logo.svg":null}).attr("width",function(t){return 2*t.value.radius*.7}).attr("height",function(t){return 2*t.value.radius*.7}),a.append("text").attr("x",function(t,e){return t.x}).attr("y",function(t,e){return t.y}).attr("class","swarm-text").style("opacity",0).attr("class","swarm-text").text(function(t){return t.value.companyName.replace(/\b\w/g,function(t){return t.toUpperCase()})}),de.filter(function(t){return-1==N.indexOf(+t.key)}).append("tspan").attr("dx",2).text(function(t){return"*"}),a.append("line").attr("class","swarm-text-dash").style("opacity",0),a.append("path").attr("class","swarm-line"),console.log("5650"),a.append("circle").attr("class","swarm-circle-two").attr("r",function(t){return 4}).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}),le=ve.selectAll(".swarm-cell-g"),_(Z)}S=C.append("div").attr("class","top-row-chart-toggle-wrapper");var o=D.append("div").attr("class","histogram-chart-toggle-wrapper"),s=[0,20,50,100,500];o.append("div").attr("class","histogram-chart-toggle-size").selectAll("p").data(s).enter().append("p").attr("class",function(t,e){return 0==e?"toggle-selected front-curve histogram-chart-toggle-item":e==s.length-1?"back-curve histogram-chart-toggle-item":"histogram-chart-toggle-item"}).text(function(t){return t}).on("click",function(t){var e=t;d3.select(this.parentNode).selectAll("p").classed("toggle-selected",function(t){return t==e}),nt=t,_(Z)});var i=["gender","race"];T=S.append("div").attr("class","histogram-chart-toggle-type histogram-chart-toggle-first"),T.selectAll("p").data(i).enter().append("p").attr("class",function(t,e){if(""!=g){if(0==e&&t==g)return"toggle-selected front-curve histogram-chart-toggle-item";if(0==e)return"front-curve histogram-chart-toggle-item";if(1==e&&t==g)return"toggle-selected back-curve histogram-chart-toggle-item";if(1==e)return"back-curve histogram-chart-toggle-item"}else{if(0==e)return"toggle-selected front-curve histogram-chart-toggle-item";if(1==e)return"back-curve histogram-chart-toggle-item"}return"histogram-chart-toggle-item"}).text(function(t){return"race"==t?"Race":"Gender"}).on("click",function(t){I.text("Embed this chart"),O.style("display",null);var e=t;d3.select(this.parentNode).selectAll("p").classed("toggle-selected",function(t){return t==e}),et=t,p.default.set("filter",et),_(Z)});var u=d3.geoAlbersUsa(),c=d3.geoPath().projection(u);A=S.append("div").attr("class","swarm-chart-map swarm-chart-min");var d=A.append("div").attr("class","map-screen").on("click",function(a){z?e():t()}),m=A.append("div").attr("class","map-close").on("click",function(t){e()});m.append("div").attr("class","map-close-icon");var v=A.append("p").attr("class","map-label").text(function(t){return"Select Region"}),w=A.append("svg").attr("class","maps-chart-svg").attr("viewBox","0 0 960 600").append("g").attr("transform","translate(0,50)");w.append("g").attr("class","states").selectAll("path").data(topojson.feature(r,r.objects.states).features).enter().append("path").attr("d",c),w.append("g").append("path").attr("class","state-borders").attr("d",c(topojson.mesh(r,r.objects.states,function(t,e){return t!==e}))),console.log("5380");var M=w.append("g").attr("class","map-markers").selectAll("circle").data(Rt.sort(function(t,e){return jt(+e.value.maxTotal)-jt(+t.value.maxTotal)})).enter().append("circle").attr("class","map-marker").attr("r",function(t){return jt(+t.value.maxTotal)}).style("fill",function(t){return t.value.hasLocation?null:"rgba(0,0,0,0)"}).attr("transform",function(t){if(t.value.hasLocation){var e=t.value.location;console.log();var a=u([+e.longitude,e.latitude]);if(a)return"translate("+a+")"}return null}).on("click",function(t){a(t)}),b=w.append("g").attr("class","map-selector").attr("transform","translate("+ft/2+","+.8*ht+")");console.log("5432"),b.append("circle").attr("class","map-selector-circle").attr("r",20),b.append("text").attr("class","map-selector-target").attr("transform","translate(0,-1)").text("+"),b.append("text").attr("class","map-selector-text").text("Show Newsrooms Here").attr("transform","translate(0,-35)");var k=o.append("div").attr("class","swarm-chart-search-div").attr("id","search-results-box");R=k.append("input").attr("class","swarm-chart-search").attr("placeholder","Find a Newsroom").on("focus",function(t){H.style("display","block")}),k.append("div").attr("class","mag-glass").append("svg").attr("xmlns","http://www.w3.org/2000/svg").attr("xmlns:xlink","http://www.w3.org/1999/xlink").attr("x","0px").attr("y","0px").attr("viewBox","0 0 100 125").attr("xml:space","preserve").append("path").attr("d","M79.2,72.3L62.9,56.7c6.3-9.1,5.3-21.7-2.8-29.9c-9.2-9.2-24-9.2-33.2,0c-9.2,9.2-9.2,24,0,33.2c8.1,8.1,20.7,9.1,29.9,2.8  l15.6,16.4c1,1,2.6,1,3.6,0l3.4-3.4C80.3,74.9,80.2,73.3,79.2,72.3z M56,56c-6.9,6.9-18.1,6.9-25,0S24,37.9,31,31s18.1-6.9,25,0  S62.9,49.1,56,56z"),H=k.append("div").attr("class","swarm-chart-search-results");var L=H.append("div").attr("class","swarm-chart-search-results-alpha-container");L.append("p").text("filter").attr("class","swarm-chart-search-results-alpha-label"),G=L.append("div").attr("class","swarm-chart-search-results-alpha-item-container").selectAll("p").data(["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"]).enter().append("p").attr("class","swarm-chart-search-results-alpha-item").text(function(t){return t}).on("click",function(t){F=t,G.style("color",function(t){return t==F?"black":null}).style("text-decoration",function(t){return t==F?"underline":null}),P.style("display",function(t){return t.value.chars.includes(F)?"block":"none"})}),P=H.append("div").attr("class","swarm-chart-search-results-result-container").selectAll("div").data(Rt).enter().append("div").attr("class","swarm-chart-search-results-result"),j=P.append("p").attr("class","swarm-chart-search-results-result-text").text(function(t){return t.value.companyName.replace(/\b\w/g,function(t){return t.toUpperCase()})}).on("click",function(t){var e=t;if(""!=y&&H.style("display",null),"table"==Z)a(t);else{var r=+t.key;Ot.map(function(t){return+t.key}).includes(r)?(B=r,_(Z)):n(e,r)}})}var k=[],N=u.map(function(t){return+t.NewsID});t.filter(function(t){return 2017==+t.Year});k=u;var S,A,D,C,L,W,T,I,O,E,R,P,j,G,H,Y=t.concat(k),F="",U={top:0,right:20,bottom:0,left:20},K=90-U.top-U.bottom,V=(d3.scaleLinear().domain([.2,.5]).range([K,0]),d3.map(i,function(t){return+t.news_id})),z=!1,q=d3.map(s,function(t){return t.city_state}),B="",X="#7354ab",J=2018,$=2001,Z="swarm",Q="swarm",tt="gender",et="gender";""!=g&&(tt=g,et=g);var at="all",rt=[],nt=25,ot=20,st=-14,it=["swarm","swarm-scatter","arrow-scatter","arrow-scatter-full","table"],lt=[];a.forEach(function(t){var e=t.Company.charAt(0),a="";t.Company.split(" ").length>1&&(a=t.Company.split(" ")[1].charAt(0)),t.chars=[e,a];var r={},n=!1;V.has(+t.NewsID)&&(r=V.get(+t.NewsID),n=!0),t.override=r,t.hasOverride=n});var ut=d3.map(e.filter(function(t){return"NULL"!=t.lng}),function(t){return t.NewsID}),ct=d3.map(a,function(t){return t.NewsID}),dt=(d3.map(w,function(t){return t[1]}),108),pt={top:40,right:20,bottom:70,left:20},ft=1e3-pt.left-pt.right,ht=300-pt.top-pt.bottom,mt=d3.select(".swarm");h<1e3&&(ft=h-pt.left-pt.right),(h<400||f)&&(ht=400-pt.top-pt.bottom);var vt=mt.append("div").attr("class","chart-top-section");!function(){function t(t){n.style("display","none"),o.transition().duration(750).text("Loading...").transition().duration(250).style("opacity",0).on("end",function(){n.style("display","block")}).transition().duration(250).style("opacity",1).text("Resume");var e;u.each(function(t,a){1==d3.select(this).classed("stepper-item-selected")&&(e=a)}),4==e&&"forward"==t&&(e=-1),"forward"==t?(Z=it[e+1],u.classed("stepper-item-selected",function(t,a){return t==Z&&a==e+1})):(Z=it[e-1],u.classed("stepper-item-selected",function(t,a){return t==Z&&a==e-1})),_(Z)}var e=vt.append("div").attr("class","stepper-container"),a=["The Newspaper Diversity Survey measures the percentage of women and minorities working in US newsrooms. The results<span class='note-new-data'>*</span> from "+J+"&rsquo;s survey are in.","Newsrooms are about 32 percetage points more white than the audience they report on.","When measuring leadership, newsrooms with more diversity tended to also have diverse staffs.","change over time","change over time 2"];e.append("div").attr("class","stepper-container-text-container").append("p").attr("class","stepper-container-text").html(function(t){return a[0]}),C=e.append("div").attr("class","stepper-toggle-row"),L=C.append("div").attr("class","stepper-back").on("click",function(e){t("backward")});var r=C.append("div").attr("class","stepper-play-button").on("click",function(e){t("forward")});L.append("svg").attr("viewBox","0 0 24 14").attr("width","100%").attr("height","100%").append("path").attr("d","M0 7.002a.999.999 0 0 0 .286.693l.006.012 6 6a1 1 0 0 0 1.414-1.414L3.414 7.998H23a1 1 0 0 0 0-2H3.414l4.292-4.291A1 1 0 0 0 6.292.293l-6 6-.006.01a.978.978 0 0 0-.208.313.974.974 0 0 0-.078.382v.004z");var n=r.append("div").attr("class","stepper-arrow"),o=r.append("p").attr("class","stepper-play-text").text("Start"),s=C.append("div").attr("class","stepper-item-container"),i=["View "+J+" <span>Gender</span> and <span>Race</span> Data","How Leadership Compares","How Top Newsrooms Changed","Overall Change for All Newsrooms","Individual Newsroom Demographics"],l=[J+" results","Leadership",$+" vs. "+J+": Top Newsrooms","Overall Change","My Newsroom"];h<620&&(l=[J+" Results","Newsroom Leaders","Top Newsrooms","Change","My Newsroom"]);var u=s.selectAll("div").data(it).enter().append("div").attr("class",function(t,e){if(""!=v){if(e==v)return"stepper-item stepper-item-selected"}else if(0==e)return"stepper-item stepper-item-selected";return"stepper-item"}).html(function(t,e){return 4==e?"<span class='stepper-text'>"+l[e]+"</span>":"<span class='stepper-text'>"+l[e]+"</span><span class='stepper-bar'> | </span>"}).on("mouseover",function(t,e){var a=e,r=t;c.style("visibility",function(t,e){return t!=r||f?null:"visible"}).html(function(){return i[a]})}).on("mouseout",function(){c.style("visibility",null)}).on("click",function(t,e){I.text("Embed this chart"),O.style("display",null),p.default.set("view",e);var a=e;d3.select(this.parentNode).selectAll(".stepper-item").classed("stepper-item-selected",function(t,e){return e==a}),Z=t,_(t)}),c=u.append("div").attr("class","stepper-item-hover").html(function(t){return""})}();var gt=d3.scaleLinear().domain([.2,.8]).range([0,ft]).clamp(!0),yt=d3.scaleLinear().domain([0,.1]).range([ht,0]),wt=mt.append("div").attr("class","swarm-chart-container").style("width",ft+pt.left+pt.right+"px"),xt=wt.append("div").attr("class","swarm-chart-container-table"),Mt=wt.append("p").attr("class","chart-title").html("Newsrooms, Broken-down <span>by Gender</span>").style("left",pt.left+"px"),_t=wt.append("div").attr("class","swarm-chart-tool-tip").style("transform","translate("+pt.left+"px,"+pt.top+"px)").on("click",function(){_t.style("visibility",null)}),bt=wt.append("svg").attr("class","swarm-chart-wrapper").attr("width",ft+pt.left+pt.right).attr("height",ht+pt.top+pt.bottom),kt=bt.append("svg:defs");kt.append("marker").attr("id","arrow-head").attr("viewBox","0 -5 10 10").attr("refX",0).attr("refY",0).attr("markerWidth",5).attr("markerHeight",3).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5").attr("fill","#d8d8d8");var Nt=kt.append("linearGradient").attr("id","gradient-blue").attr("x1",0).attr("x2",1).attr("y1",0).attr("y2",0),St=kt.append("linearGradient").attr("id","gradient-average").attr("x1",0).attr("x2",1).attr("y1",0).attr("y2",0);St.append("stop").attr("stop-color","black").attr("stop-opacity",.15),St.append("stop").attr("offset","100%").attr("stop-color","black").attr("stop-opacity",1),Nt.append("stop").attr("stop-color","blue").attr("stop-opacity",.15),Nt.append("stop").attr("offset","100%").attr("stop-color","blue").attr("stop-opacity",1);var At=kt.append("linearGradient").attr("id","gradient-red").attr("x1",1).attr("x2",0).attr("y1",0).attr("y2",0);At.append("stop").attr("stop-color","red").attr("stop-opacity",.15),At.append("stop").attr("offset","100%").attr("stop-color","red").attr("stop-opacity",1);var Dt=kt.append("linearGradient").attr("id","gradient-right").attr("x1",0).attr("x2",1).attr("y1",0).attr("y2",0);Dt.append("stop").attr("stop-color","#a7a7a7").attr("stop-opacity",.15),Dt.append("stop").attr("offset","100%").attr("stop-color","#a7a7a7").attr("stop-opacity",1);var Ct=kt.append("linearGradient").attr("id","gradient-left").attr("x1",1).attr("x2",0).attr("y1",0).attr("y2",0);Ct.append("stop").attr("stop-color","#868686").attr("stop-opacity",.15),Ct.append("stop").attr("offset","100%").attr("stop-color","#868686").attr("stop-opacity",1),kt.append("marker").attr("id","arrow-head-black").attr("viewBox","0 -5 10 10").attr("refX",0).attr("refY",0).attr("markerWidth",7).attr("markerHeight",10).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5").attr("fill","#000000");var Lt=Y.filter(function(t){return"supWhite"==et||"supGender"==et?t.total_num>nt&&t.total_sup_num>0:t}),Wt=[],Tt=[],It=[],Ot=d3.nest().key(function(t){return+t.NewsID}).rollup(function(t){var e=d3.map(t,function(t){return t.Year}),a=d3.max(t,function(t){return t.total_num}),r=d3.max(t,function(t){return d(t)});return Wt.push(r),{yearMap:e,values:t,maxTotal:a}}).entries(Lt),Et=[],Rt=[];Ot=Ot.filter(function(t){return t.value.yearMap.has(J)?t:null});var Pt=d3.extent(Ot,function(t){return+t.value.yearMap.get(J).total_num});Pt[1]=600;var jt=d3.scaleLinear().domain([nt,Pt[1]]).range([4,24]).clamp(!0);for(var Gt in Ot){var Ht=x("supGender",Ot[Gt].value),Yt=x("gender",Ot[Gt].value),Ft=x("gender-old",Ot[Gt].value),Ut=0;Ut="n/a"==Ft?null:Yt-Ft;var Kt=9999,Vt=9999,zt=9999,qt=9999,Bt=50,Xt=ct.get(Ot[Gt].key),Jt=Xt.City+" "+Xt.State;Ot[Gt].value.companyData=Xt,Xt.hasOverride?(Kt=+Xt.override.white/100,Vt=+Xt.override.black/100,zt=+Xt.override.hispanic/100,Bt=Xt.override.female,qt=Xt.override.asian/100,"n/a"!=Bt&&(Bt=+Bt/100)):q.has(Jt)&&(Kt=+q.get(Jt).white_2015/100,Vt=+q.get(Jt).black_2015/100,zt=+q.get(Jt).hispanic_2015/100,Bt=q.get(Jt).female_2015/100,qt=q.get(Jt).asian_2015/100),Ot[Gt].value.whiteCensus=Kt,Ot[Gt].value.blackCensus=Vt,Ot[Gt].value.hispanicCensus=zt,Ot[Gt].value.femaleCensus=Bt,Ot[Gt].value.asianCensus=qt;var $t=0;$t="n/a"==x("race-old",Ot[Gt].value)?null:x("race",Ot[Gt].value)-x("race-old",Ot[Gt].value),Tt.push(Ut),It.push($t),Ot[Gt].value.companyName=Xt.Company;var Zt=Xt.Company.charAt(0),Qt="";Xt.Company.split(" ").length>1&&(Qt=Xt.Company.split(" ")[1].charAt(0)),Ot[Gt].value.chars=[Zt,Qt],Ot[Gt].value.whiteDelta=x("race",Ot[Gt].value),Ot[Gt].value.diff=Ut,Ot[Gt].value.raceDiff=$t;var te=+Ot[Gt].value.yearMap.get(J).total_num;if(Ot[Gt].value.radius=jt(te),Ot[Gt].value.currentYear=Yt,Ot[Gt].value.previousYear=Ft,Ot[Gt].value.currentSup=Ht,ut.has(Ot[Gt].key)){var ee=ut.get(Ot[Gt].key);Ot[Gt].value.location={latitude:+ee.lat,longitude:+ee.lng},Ot[Gt].value.hasLocation=!0}else Ot[Gt].value.hasLocation=!1}Ot=Ot.filter(function(t){return Rt.push(t),t.value.yearMap.get(J).total_num>nt?t:(Et.push(t),null)}),Ot=Ot.sort(function(t,e){return e.value.radius-t.value.radius});var ae=-1;for(var Gt in Ot)Ot[Gt].value.miniChart=-1,Ot[Gt].value.yearMap.has($)&&ae<21&&(ae+=1,Ot[Gt].value.miniChart=ae);var re=d3.mean(Ot,function(t){return"n/a"==t.value.previousYear?null:t.value.previousYear}),ne=d3.mean(Ot,function(t){return t.value.currentYear}),oe=d3.mean(Ot,function(t){return x("supGender",t.value)}),se=(d3.map(Ot,function(t){return t.key}),d3.extent(Tt,function(t){return t})),ie=(d3.scaleLinear().domain(se).range(["green","red"]),d3.scaleLinear().domain([.2,.5,.8]).range(["#2161fa","#dddddd","#ff3333"]));"race"==et&&ie.domain([0,.5,1]);var le,ue,ce,de,pe,fe,he,me=bt.append("g").attr("transform","translate("+pt.left+","+pt.top+")").attr("class","swarm-axis"),ve=bt.append("g").attr("transform","translate("+pt.left+","+pt.top+")"),ge=750;_("new")}Object.defineProperty(e,"__esModule",{value:!0});var i=a(18),l=r(i),u=a(15),c=r(u),d=a(16),p=r(d),f=!1;/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(f=!0);var h=Math.max(document.documentElement.clientWidth,window.innerWidth||0),m=(Math.max(document.documentElement.clientHeight,window.innerHeight||0),4);h<800&&(m=3),h<700&&(m=2),h<500&&(m=1);var v=p.default.get("view"),g=p.default.get("filter"),y=p.default.get("embed");console.log(y),y&&d3.select("#content").classed("embedded",!0);var w=[["Maine","ME",1,"Northeast",23],["Vermont","VT",2,"Northeast",50],["New Hampshire","NH",3,"Northeast",33],["Rhode Island","RI",4,"Northeast",44],["Massachusetts","MA",5,"Northeast",25],["Connecticut","CT",6,"Northeast",9],["Delaware","DE",7,"Northeast",10],["New Jersey","NJ",8,"Northeast",34],["New York","NY",9,"Northeast",36],["Pennsylvania","PA",10,"Northeast",42],["District of Columbia","DC",11,"Northeast",11],["Maryland","MD",12,"Northeast",24],["Virginia","VA",13,"South",51],["North Carolina","NC",14,"South",37],["South Carolina","SC",15,"South",45],["Georgia","GA",16,"South",13],["Alabama","AL",17,"South",1],["Mississippi","MS",18,"South",28],["Louisiana","LA",19,"South",22],["Arkansas","AR",20,"South",5],["Tennessee","TN",21,"South",47],["Kentucky","KY",22,"South",21],["West Virginia","WV",23,"South",54],["Oklahoma","OK",24,"Midwest",40],["Colorado","CO",25,"West",8],["Utah","UT",26,"West",49],["Idaho","ID",27,"West",16],["Wyoming","WY",28,"West",56],["Montana","MT",29,"West",30],["North Dakota","ND",30,"Midwest",38],["South Dakota","SD",31,"Midwest",46],["Nebraska","NE",32,"Midwest",31],["Kansas","KS",33,"Midwest",20],["Iowa","IA",34,"Midwest",19],["Minnesota","MN",35,"Midwest",27],["Wisconsin","WI",36,"Midwest",55],["Indiana","IN",37,"Midwest",18],["Missouri","MO",38,"Midwest",29],["Ohio","OH",39,"Midwest",39],["Michigan","MI",40,"Midwest",26],["Illinois","IL",41,"Midwest",17],["Florida","FL",42,"South",12],["California","CA",43,"West",6],["Nevada","NV",44,"West",32],["Texas","TX",45,"South",48],["Arizona","AZ",46,"West",4],["New Mexico","NM",47,"West",35],["Alaska","AK",48,"West",2],["Washington","WA",49,"West",53],["Oregon","OR",50,"West",41],["Hawaii","HI",51,"West",15]];e.default={init:s}},function(t,e,a){"use strict"},function(t,e,a){"use strict";function r(){if(u)return Promise.resolve(l);return new Promise(function(t,e){i.default.get("https://api.ipify.org?format=json").end(function(a,r){a?e(a):r&&r.status>=200&&r.status<400?t(JSON.parse(r.text)):e()})})}function n(t){var e=t.ip;if(u)return Promise.resolve(l);var a="https://freegeoip.net/json/"+e;return new Promise(function(t,e){i.default.get(a).end(function(a,r){a?e(a):r&&r.status>=200&&r.status<400?t(JSON.parse(r.text)):e()})})}function o(t){var e=setTimeout(function(){return t("timeout")},c);r().then(n).then(function(a){clearTimeout(e),t(null,a)}).catch(function(e){return t(e)})}Object.defineProperty(e,"__esModule",{value:!0}),a(0);var s=a(20),i=function(t){return t&&t.__esModule?t:{default:t}}(s),l={ip:"24.194.26.74",country_code:"US",country_name:"United States",region_code:"MA",region_name:"Massachusetts",city:"Great Barrington",zip_code:"01230",time_zone:"America/New_York",latitude:42.1617,longitude:-73.3277,metro_code:532},u=!1,c=4e3;e.default=o},function(t,e,a){"use strict";function r(t){var e=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),a=new RegExp("[\\?&]"+e+"=([^&#]*)"),r=a.exec(window.location.search);return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))}function n(t,e){var a=[window.location.protocol,"//",window.location.host,window.location.pathname].join(""),r=document.location.search,n=t+"="+e,o="?"+n;if(r){var s=new RegExp("([?&])"+t+"[^&]*"),i=new RegExp("([?&])"+t+"=[^&;]+[&;]?");void 0===e||null===e||""===e?(o=r.replace(i,"$1"),o=o.replace(/[&;]$/,"")):o=null!==r.match(s)?r.replace(s,"$1"+n):r+"&"+n}o="?"===o?"":o,window.history.replaceState({},"",""+a+o)}Object.defineProperty(e,"__esModule",{value:!0}),e.default={get:r,set:n}},function(t,e,a){function r(t){if(t)return n(t)}function n(t){for(var e in r.prototype)t[e]=r.prototype[e];return t}t.exports=r,r.prototype.on=r.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},r.prototype.once=function(t,e){function a(){this.off(t,a),e.apply(this,arguments)}return a.fn=e,this.on(t,a),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var a=this._callbacks["$"+t];if(!a)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var r,n=0;n<a.length;n++)if((r=a[n])===e||r.fn===e){a.splice(n,1);break}return this},r.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),a=this._callbacks["$"+t];if(a){a=a.slice(0);for(var r=0,n=a.length;r<n;++r)a[r].apply(this,e)}return this},r.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},r.prototype.hasListeners=function(t){return!!this.listeners(t).length}},function(t,e,a){var r,n;!function(a,o){"use strict";function s(){}s.TO_RAD=Math.PI/180,s.TO_DEG=180/Math.PI,s.PI_X2=2*Math.PI,s.PI_DIV4=Math.PI/4;var i=Object.create(s.prototype,{version:{value:"2.0.23"},radius:{value:6378137},minLat:{value:-90},maxLat:{value:90},minLon:{value:-180},maxLon:{value:180},sexagesimalPattern:{value:/^([0-9]{1,3})°\s*([0-9]{1,3}(?:\.(?:[0-9]{1,2}))?)'\s*(([0-9]{1,3}(\.([0-9]{1,4}))?)"\s*)?([NEOSW]?)$/},measures:{value:Object.create(Object.prototype,{m:{value:1},km:{value:.001},cm:{value:100},mm:{value:1e3},mi:{value:1/1609.344},sm:{value:1/1852.216},ft:{value:100/30.48},in:{value:100/2.54},yd:{value:1/.9144}})},prototype:{value:s.prototype},extend:{value:function(t,e){for(var a in t)void 0!==i.prototype[a]&&!0!==e||("function"==typeof t[a]&&"function"==typeof t[a].bind?i.prototype[a]=t[a].bind(i):i.prototype[a]=t[a])}}});void 0===Number.prototype.toRad&&(Number.prototype.toRad=function(){return this*s.TO_RAD}),void 0===Number.prototype.toDeg&&(Number.prototype.toDeg=function(){return this*s.TO_DEG}),i.extend({decimal:{},sexagesimal:{},distance:null,getKeys:function(t){if("[object Array]"==Object.prototype.toString.call(t))return{longitude:t.length>=1?0:void 0,latitude:t.length>=2?1:void 0,elevation:t.length>=3?2:void 0};var e=function(e){var a;return e.every(function(e){return"object"!=typeof t||(!t.hasOwnProperty(e)||function(){return a=e,!1}())}),a},a=e(["lng","lon","longitude"]),r=e(["lat","latitude"]),n=e(["alt","altitude","elevation","elev"]);return void 0!==r||void 0!==a||void 0!==n?{latitude:r,longitude:a,elevation:n}:void 0},getLat:function(t,e){return!0===e?t[this.getKeys(t).latitude]:this.useDecimal(t[this.getKeys(t).latitude])},latitude:function(t){return this.getLat.call(this,t)},getLon:function(t,e){return!0===e?t[this.getKeys(t).longitude]:this.useDecimal(t[this.getKeys(t).longitude])},longitude:function(t){return this.getLon.call(this,t)},getElev:function(t){return t[this.getKeys(t).elevation]},elevation:function(t){return this.getElev.call(this,t)},coords:function(t,e){var a={latitude:!0===e?t[this.getKeys(t).latitude]:this.useDecimal(t[this.getKeys(t).latitude]),longitude:!0===e?t[this.getKeys(t).longitude]:this.useDecimal(t[this.getKeys(t).longitude])},r=t[this.getKeys(t).elevation];return void 0!==r&&(a.elevation=r),a},ll:function(t,e){return this.coords.call(this,t,e)},validate:function(t){var e=this.getKeys(t);if(void 0===e||void 0===e.latitude||"undefined"===e.longitude)return!1;var a=t[e.latitude],r=t[e.longitude];return!(void 0===a||!this.isDecimal(a)&&!this.isSexagesimal(a))&&(!(void 0===r||!this.isDecimal(r)&&!this.isSexagesimal(r))&&(a=this.useDecimal(a),r=this.useDecimal(r),!(a<this.minLat||a>this.maxLat||r<this.minLon||r>this.maxLon)))},getDistance:function(t,e,a,r){a=Math.floor(a)||1,r=Math.floor(r)||0;var n,o,s,l,u,c,d,p=this.coords(t),f=this.coords(e),h=6378137,m=6356752.314245,v=1/298.257223563,g=(f.longitude-p.longitude).toRad(),y=Math.atan((1-v)*Math.tan(parseFloat(p.latitude).toRad())),w=Math.atan((1-v)*Math.tan(parseFloat(f.latitude).toRad())),x=Math.sin(y),M=Math.cos(y),_=Math.sin(w),b=Math.cos(w),k=g,N=100;do{var S=Math.sin(k),A=Math.cos(k);if(0===(c=Math.sqrt(b*S*(b*S)+(M*_-x*b*A)*(M*_-x*b*A))))return i.distance=0;n=x*_+M*b*A,o=Math.atan2(c,n),s=M*b*S/c,l=1-s*s,u=n-2*x*_/l,isNaN(u)&&(u=0);var D=v/16*l*(4+v*(4-3*l));d=k,k=g+(1-D)*v*s*(o+D*c*(u+D*n*(2*u*u-1)))}while(Math.abs(k-d)>1e-12&&--N>0);if(0===N)return NaN;var C=l*(h*h-m*m)/(m*m),L=1+C/16384*(4096+C*(C*(320-175*C)-768)),W=C/1024*(256+C*(C*(74-47*C)-128)),T=W*c*(u+W/4*(n*(2*u*u-1)-W/6*u*(4*c*c-3)*(4*u*u-3))),I=m*L*(o-T);if(I=I.toFixed(r),void 0!==this.elevation(t)&&void 0!==this.elevation(e)){var O=Math.abs(this.elevation(t)-this.elevation(e));I=Math.sqrt(I*I+O*O)}return this.distance=Math.round(I*Math.pow(10,r)/a)*a/Math.pow(10,r)},getDistanceSimple:function(t,e,a){a=Math.floor(a)||1;var r=Math.round(Math.acos(Math.sin(this.latitude(e).toRad())*Math.sin(this.latitude(t).toRad())+Math.cos(this.latitude(e).toRad())*Math.cos(this.latitude(t).toRad())*Math.cos(this.longitude(t).toRad()-this.longitude(e).toRad()))*this.radius);return i.distance=Math.floor(Math.round(r/a)*a)},getCenter:function(t){var e=t;if("object"==typeof t&&!(t instanceof Array)){e=[];for(var a in t)e.push(this.coords(t[a]))}if(!e.length)return!1;var r,n,o,i=0,l=0,u=0;e.forEach(function(t){r=this.latitude(t).toRad(),n=this.longitude(t).toRad(),i+=Math.cos(r)*Math.cos(n),l+=Math.cos(r)*Math.sin(n),u+=Math.sin(r)},this);var c=e.length;return i/=c,l/=c,u/=c,n=Math.atan2(l,i),o=Math.sqrt(i*i+l*l),r=Math.atan2(u,o),{latitude:(r*s.TO_DEG).toFixed(6),longitude:(n*s.TO_DEG).toFixed(6)}},getBounds:function(t){if(!t.length)return!1;var e=this.elevation(t[0]),a={maxLat:-1/0,minLat:1/0,maxLng:-1/0,minLng:1/0};void 0!==e&&(a.maxElev=0,a.minElev=1/0);for(var r=0,n=t.length;r<n;++r)a.maxLat=Math.max(this.latitude(t[r]),a.maxLat),a.minLat=Math.min(this.latitude(t[r]),a.minLat),a.maxLng=Math.max(this.longitude(t[r]),a.maxLng),a.minLng=Math.min(this.longitude(t[r]),a.minLng),e&&(a.maxElev=Math.max(this.elevation(t[r]),a.maxElev),a.minElev=Math.min(this.elevation(t[r]),a.minElev));return a},getCenterOfBounds:function(t){var e=this.getBounds(t),a=e.minLat+(e.maxLat-e.minLat)/2,r=e.minLng+(e.maxLng-e.minLng)/2;return{latitude:parseFloat(a.toFixed(6)),longitude:parseFloat(r.toFixed(6))}},getBoundsOfDistance:function(t,e){var a,r,n=this.latitude(t),o=this.longitude(t),i=n.toRad(),l=o.toRad(),u=e/this.radius,c=i-u,d=i+u,p=this.maxLat.toRad(),f=this.minLat.toRad(),h=this.maxLon.toRad(),m=this.minLon.toRad();if(c>f&&d<p){var v=Math.asin(Math.sin(u)/Math.cos(i));a=l-v,a<m&&(a+=s.PI_X2),r=l+v,r>h&&(r-=s.PI_X2)}else c=Math.max(c,f),d=Math.min(d,p),a=m,r=h;return[{latitude:c.toDeg(),longitude:a.toDeg()},{latitude:d.toDeg(),longitude:r.toDeg()}]},isPointInside:function(t,e){for(var a=!1,r=-1,n=e.length,o=n-1;++r<n;o=r)(this.longitude(e[r])<=this.longitude(t)&&this.longitude(t)<this.longitude(e[o])||this.longitude(e[o])<=this.longitude(t)&&this.longitude(t)<this.longitude(e[r]))&&this.latitude(t)<(this.latitude(e[o])-this.latitude(e[r]))*(this.longitude(t)-this.longitude(e[r]))/(this.longitude(e[o])-this.longitude(e[r]))+this.latitude(e[r])&&(a=!a);return a},preparePolygonForIsPointInsideOptimized:function(t){for(var e=0,a=t.length-1;e<t.length;e++)this.longitude(t[a])===this.longitude(t[e])?(t[e].constant=this.latitude(t[e]),t[e].multiple=0):(t[e].constant=this.latitude(t[e])-this.longitude(t[e])*this.latitude(t[a])/(this.longitude(t[a])-this.longitude(t[e]))+this.longitude(t[e])*this.latitude(t[e])/(this.longitude(t[a])-this.longitude(t[e])),t[e].multiple=(this.latitude(t[a])-this.latitude(t[e]))/(this.longitude(t[a])-this.longitude(t[e]))),a=e},isPointInsideWithPreparedPolygon:function(t,e){for(var a=!1,r=this.longitude(t),n=this.latitude(t),o=0,s=e.length-1;o<e.length;o++)(this.longitude(e[o])<r&&this.longitude(e[s])>=r||this.longitude(e[s])<r&&this.longitude(e[o])>=r)&&(a^=r*e[o].multiple+e[o].constant<n),s=o;return a},isInside:function(){return this.isPointInside.apply(this,arguments)},isPointInCircle:function(t,e,a){return this.getDistance(t,e)<a},withinRadius:function(){return this.isPointInCircle.apply(this,arguments)},getRhumbLineBearing:function(t,e){var a=this.longitude(e).toRad()-this.longitude(t).toRad(),r=Math.log(Math.tan(this.latitude(e).toRad()/2+s.PI_DIV4)/Math.tan(this.latitude(t).toRad()/2+s.PI_DIV4));return Math.abs(a)>Math.PI&&(a=a>0?-1*(s.PI_X2-a):s.PI_X2+a),(Math.atan2(a,r).toDeg()+360)%360},getBearing:function(t,e){return e.latitude=this.latitude(e),e.longitude=this.longitude(e),t.latitude=this.latitude(t),t.longitude=this.longitude(t),(Math.atan2(Math.sin(e.longitude.toRad()-t.longitude.toRad())*Math.cos(e.latitude.toRad()),Math.cos(t.latitude.toRad())*Math.sin(e.latitude.toRad())-Math.sin(t.latitude.toRad())*Math.cos(e.latitude.toRad())*Math.cos(e.longitude.toRad()-t.longitude.toRad())).toDeg()+360)%360},getCompassDirection:function(t,e,a){var r,n;switch(n="circle"==a?this.getBearing(t,e):this.getRhumbLineBearing(t,e),Math.round(n/22.5)){case 1:r={exact:"NNE",rough:"N"};break;case 2:r={exact:"NE",rough:"N"};break;case 3:r={exact:"ENE",rough:"E"};break;case 4:r={exact:"E",rough:"E"};break;case 5:r={exact:"ESE",rough:"E"};break;case 6:r={exact:"SE",rough:"E"};break;case 7:r={exact:"SSE",rough:"S"};break;case 8:r={exact:"S",rough:"S"};break;case 9:r={exact:"SSW",rough:"S"};break;case 10:r={exact:"SW",rough:"S"};break;case 11:r={exact:"WSW",rough:"W"};break;case 12:r={exact:"W",rough:"W"};break;case 13:r={exact:"WNW",rough:"W"};break;case 14:r={exact:"NW",rough:"W"};break;case 15:r={exact:"NNW",rough:"N"};break;default:r={exact:"N",rough:"N"}}return r.bearing=n,r},getDirection:function(t,e,a){return this.getCompassDirection.apply(this,arguments)},orderByDistance:function(t,e){return Object.keys(e).map(function(a){var r=this.getDistance(t,e[a]),n=Object.create(e[a]);return n.distance=r,n.key=a,n},this).sort(function(t,e){return t.distance-e.distance})},isPointInLine:function(t,e,a){return(this.getDistance(e,t,1,3)+this.getDistance(t,a,1,3)).toFixed(3)==this.getDistance(e,a,1,3)},isPointNearLine:function(t,e,a,r){return this.getDistanceFromLine(t,e,a)<r},getDistanceFromLine:function(t,e,a){var r=this.getDistance(e,t,1,3),n=this.getDistance(t,a,1,3),o=this.getDistance(e,a,1,3),s=Math.acos((r*r+o*o-n*n)/(2*r*o)),i=Math.acos((n*n+o*o-r*r)/(2*n*o));return s>Math.PI/2?r:i>Math.PI/2?n:Math.sin(s)*r},findNearest:function(t,e,a,r){a=a||0,r=r||1;var n=this.orderByDistance(t,e);return 1===r?n[a]:n.splice(a,r)},getPathLength:function(t){for(var e,a=0,r=0,n=t.length;r<n;++r)e&&(a+=this.getDistance(this.coords(t[r]),e)),e=this.coords(t[r]);return a},getSpeed:function(t,e,a){var r=a&&a.unit||"km";"mph"==r?r="mi":"kmh"==r&&(r="km");var n=i.getDistance(t,e),o=1*e.time/1e3-1*t.time/1e3,s=n/o*3600;return Math.round(s*this.measures[r]*1e4)/1e4},computeDestinationPoint:function(t,e,a,r){var n=this.latitude(t),o=this.longitude(t);r=void 0===r?this.radius:Number(r);var s=Number(e)/r,i=Number(a).toRad(),l=Number(n).toRad(),u=Number(o).toRad(),c=Math.asin(Math.sin(l)*Math.cos(s)+Math.cos(l)*Math.sin(s)*Math.cos(i)),d=u+Math.atan2(Math.sin(i)*Math.sin(s)*Math.cos(l),Math.cos(s)-Math.sin(l)*Math.sin(c));return d=(d+3*Math.PI)%(2*Math.PI)-Math.PI,{latitude:c.toDeg(),longitude:d.toDeg()}},convertUnit:function(t,e,a){if(0===e)return 0;if(void 0===e){if(null===this.distance)throw new Error("No distance was given");if(0===this.distance)return 0;e=this.distance}if(t=t||"m",a=null==a?4:a,void 0!==this.measures[t])return this.round(e*this.measures[t],a);throw new Error("Unknown unit for conversion.")},useDecimal:function(t){if("[object Array]"===Object.prototype.toString.call(t)){var e=this;return t=t.map(function(t){if(e.isDecimal(t))return e.useDecimal(t);if("object"==typeof t){if(e.validate(t))return e.coords(t);for(var a in t)t[a]=e.useDecimal(t[a]);return t}return e.isSexagesimal(t)?e.sexagesimal2decimal(t):t})}if("object"==typeof t&&this.validate(t))return this.coords(t);if("object"==typeof t){for(var a in t)t[a]=this.useDecimal(t[a]);return t}if(this.isDecimal(t))return parseFloat(t);if(!0===this.isSexagesimal(t))return parseFloat(this.sexagesimal2decimal(t));throw new Error("Unknown format.")},decimal2sexagesimal:function(t){if(t in this.sexagesimal)return this.sexagesimal[t];var e=t.toString().split("."),a=Math.abs(e[0]),r=60*("0."+(e[1]||0)),n=r.toString().split(".");return r=Math.floor(r),n=(60*("0."+(n[1]||0))).toFixed(2),this.sexagesimal[t]=a+"° "+r+"' "+n+'"',this.sexagesimal[t]},sexagesimal2decimal:function(t){if(t in this.decimal)return this.decimal[t];var e=new RegExp(this.sexagesimalPattern),a=e.exec(t),r=0,n=0;a&&(r=parseFloat(a[2]/60),n=parseFloat(a[4]/3600)||0);var o=(parseFloat(a[1])+r+n).toFixed(8);return o="S"==a[7]||"W"==a[7]?parseFloat(-o):parseFloat(o),this.decimal[t]=o,o},isDecimal:function(t){return t=t.toString().replace(/\s*/,""),!isNaN(parseFloat(t))&&parseFloat(t)==t},isSexagesimal:function(t){return t=t.toString().replace(/\s*/,""),this.sexagesimalPattern.test(t)},round:function(t,e){var a=Math.pow(10,e);return Math.round(t*a)/a}}),void 0!==t&&void 0!==t.exports?(t.exports=i,"object"==typeof a&&(a.geolib=i)):(r=[],void 0!==(n=function(){return i}.apply(e,r))&&(t.exports=n))}(this)},function(t,e){function a(){this._defaults=[]}["use","on","once","set","query","type","accept","auth","withCredentials","sortQuery","retry","ok","redirects","timeout","buffer","serialize","parse","ca","key","pfx","cert"].forEach(function(t){a.prototype[t]=function(){return this._defaults.push({fn:t,arguments:arguments}),this}}),a.prototype._setDefaults=function(t){this._defaults.forEach(function(e){t[e.fn].apply(t,e.arguments)})},t.exports=a},function(t,e,a){function r(){}function n(t){if(!m(t))return t;var e=[];for(var a in t)o(e,a,t[a]);return e.join("&")}function o(t,e,a){if(null!=a)if(Array.isArray(a))a.forEach(function(a){o(t,e,a)});else if(m(a))for(var r in a)o(t,e+"["+r+"]",a[r]);else t.push(encodeURIComponent(e)+"="+encodeURIComponent(a));else null===a&&t.push(encodeURIComponent(e))}function s(t){for(var e,a,r={},n=t.split("&"),o=0,s=n.length;o<s;++o)e=n[o],a=e.indexOf("="),-1==a?r[decodeURIComponent(e)]="":r[decodeURIComponent(e.slice(0,a))]=decodeURIComponent(e.slice(a+1));return r}function i(t){for(var e,a,r,n,o=t.split(/\r?\n/),s={},i=0,l=o.length;i<l;++i)a=o[i],-1!==(e=a.indexOf(":"))&&(r=a.slice(0,e).toLowerCase(),n=w(a.slice(e+1)),s[r]=n);return s}function l(t){return/[\/+]json($|[^-\w])/.test(t)}function u(t){this.req=t,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||void 0===this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText;var e=this.xhr.status;1223===e&&(e=204),this._setStatusProperties(e),this.header=this.headers=i(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this._setHeaderProperties(this.header),null===this.text&&t._responseType?this.body=this.xhr.response:this.body="HEAD"!=this.req.method?this._parseBody(this.text?this.text:this.xhr.response):null}function c(t,e){var a=this;this._query=this._query||[],this.method=t,this.url=e,this.header={},this._header={},this.on("end",function(){var t=null,e=null;try{e=new u(a)}catch(e){return t=new Error("Parser is unable to parse the response"),t.parse=!0,t.original=e,a.xhr?(t.rawResponse=void 0===a.xhr.responseType?a.xhr.responseText:a.xhr.response,t.status=a.xhr.status?a.xhr.status:null,t.statusCode=t.status):(t.rawResponse=null,t.status=null),a.callback(t)}a.emit("response",e);var r;try{a._isResponseOK(e)||(r=new Error(e.statusText||"Unsuccessful HTTP response"))}catch(t){r=t}r?(r.original=t,r.response=e,r.status=e.status,a.callback(r,e)):a.callback(null,e)})}function d(t,e,a){var r=y("DELETE",t);return"function"==typeof e&&(a=e,e=null),e&&r.send(e),a&&r.end(a),r}var p;"undefined"!=typeof window?p=window:"undefined"!=typeof self?p=self:(console.warn("Using browser-only version of superagent in non-browser environment"),p=this);var f=a(17),h=a(21),m=a(1),v=a(22),g=a(19),y=e=t.exports=function(t,a){return"function"==typeof a?new e.Request("GET",t).end(a):1==arguments.length?new e.Request("GET",t):new e.Request(t,a)};e.Request=c,y.getXHR=function(){if(!(!p.XMLHttpRequest||p.location&&"file:"==p.location.protocol&&p.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){}throw Error("Browser-only version of superagent could not find XHR")};var w="".trim?function(t){return t.trim()}:function(t){return t.replace(/(^\s*|\s*$)/g,"")};y.serializeObject=n,y.parseString=s,y.types={html:"text/html",json:"application/json",xml:"text/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},y.serialize={"application/x-www-form-urlencoded":n,"application/json":JSON.stringify},y.parse={"application/x-www-form-urlencoded":s,"application/json":JSON.parse},v(u.prototype),u.prototype._parseBody=function(t){var e=y.parse[this.type];return this.req._parser?this.req._parser(this,t):(!e&&l(this.type)&&(e=y.parse["application/json"]),e&&t&&(t.length||t instanceof Object)?e(t):null)},u.prototype.toError=function(){var t=this.req,e=t.method,a=t.url,r="cannot "+e+" "+a+" ("+this.status+")",n=new Error(r);return n.status=this.status,n.method=e,n.url=a,n},y.Response=u,f(c.prototype),h(c.prototype),c.prototype.type=function(t){return this.set("Content-Type",y.types[t]||t),this},c.prototype.accept=function(t){return this.set("Accept",y.types[t]||t),this},c.prototype.auth=function(t,e,a){1===arguments.length&&(e=""),"object"==typeof e&&null!==e&&(a=e,e=""),a||(a={type:"function"==typeof btoa?"basic":"auto"});var r=function(t){if("function"==typeof btoa)return btoa(t);throw new Error("Cannot use basic auth, btoa is not a function")};return this._auth(t,e,a,r)},c.prototype.query=function(t){return"string"!=typeof t&&(t=n(t)),t&&this._query.push(t),this},c.prototype.attach=function(t,e,a){if(e){if(this._data)throw Error("superagent can't mix .send() and .attach()");this._getFormData().append(t,e,a||e.name)}return this},c.prototype._getFormData=function(){return this._formData||(this._formData=new p.FormData),this._formData},c.prototype.callback=function(t,e){if(this._shouldRetry(t,e))return this._retry();var a=this._callback;this.clearTimeout(),t&&(this._maxRetries&&(t.retries=this._retries-1),this.emit("error",t)),a(t,e)},c.prototype.crossDomainError=function(){var t=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");t.crossDomain=!0,t.status=this.status,t.method=this.method,t.url=this.url,this.callback(t)},c.prototype.buffer=c.prototype.ca=c.prototype.agent=function(){return console.warn("This is not supported in browser version of superagent"),this},c.prototype.pipe=c.prototype.write=function(){throw Error("Streaming is not supported in browser version of superagent")},c.prototype._isHost=function(t){return t&&"object"==typeof t&&!Array.isArray(t)&&"[object Object]"!==Object.prototype.toString.call(t)},c.prototype.end=function(t){return this._endCalled&&console.warn("Warning: .end() was called twice. This is not supported in superagent"),this._endCalled=!0,this._callback=t||r,this._finalizeQueryString(),this._end()},c.prototype._end=function(){var t=this,e=this.xhr=y.getXHR(),a=this._formData||this._data;this._setTimeouts(),e.onreadystatechange=function(){var a=e.readyState;if(a>=2&&t._responseTimeoutTimer&&clearTimeout(t._responseTimeoutTimer),4==a){var r;try{r=e.status}catch(t){r=0}if(!r){if(t.timedout||t._aborted)return;return t.crossDomainError()}t.emit("end")}};var r=function(e,a){a.total>0&&(a.percent=a.loaded/a.total*100),a.direction=e,t.emit("progress",a)};if(this.hasListeners("progress"))try{e.onprogress=r.bind(null,"download"),e.upload&&(e.upload.onprogress=r.bind(null,"upload"))}catch(t){}try{this.username&&this.password?e.open(this.method,this.url,!0,this.username,this.password):e.open(this.method,this.url,!0)}catch(t){return this.callback(t)}if(this._withCredentials&&(e.withCredentials=!0),!this._formData&&"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof a&&!this._isHost(a)){var n=this._header["content-type"],o=this._serializer||y.serialize[n?n.split(";")[0]:""];!o&&l(n)&&(o=y.serialize["application/json"]),o&&(a=o(a))}for(var s in this.header)null!=this.header[s]&&this.header.hasOwnProperty(s)&&e.setRequestHeader(s,this.header[s]);return this._responseType&&(e.responseType=this._responseType),this.emit("request",this),e.send(void 0!==a?a:null),this},y.agent=function(){return new g},["GET","POST","OPTIONS","PATCH","PUT","DELETE"].forEach(function(t){g.prototype[t.toLowerCase()]=function(e,a){var r=new y.Request(t,e);return this._setDefaults(r),a&&r.end(a),r}}),g.prototype.del=g.prototype.delete,y.get=function(t,e,a){var r=y("GET",t);return"function"==typeof e&&(a=e,e=null),e&&r.query(e),a&&r.end(a),r},y.head=function(t,e,a){var r=y("HEAD",t);return"function"==typeof e&&(a=e,e=null),e&&r.query(e),a&&r.end(a),r},y.options=function(t,e,a){var r=y("OPTIONS",t);return"function"==typeof e&&(a=e,e=null),e&&r.send(e),a&&r.end(a),r},y.del=d,y.delete=d,y.patch=function(t,e,a){var r=y("PATCH",t);return"function"==typeof e&&(a=e,e=null),e&&r.send(e),a&&r.end(a),r},y.post=function(t,e,a){var r=y("POST",t);return"function"==typeof e&&(a=e,e=null),e&&r.send(e),a&&r.end(a),r},y.put=function(t,e,a){var r=y("PUT",t);return"function"==typeof e&&(a=e,e=null),e&&r.send(e),a&&r.end(a),r}},function(t,e,a){"use strict";function r(t){if(t)return n(t)}function n(t){for(var e in r.prototype)t[e]=r.prototype[e];return t}var o=a(1);t.exports=r,r.prototype.clearTimeout=function(){return clearTimeout(this._timer),clearTimeout(this._responseTimeoutTimer),delete this._timer,delete this._responseTimeoutTimer,this},r.prototype.parse=function(t){return this._parser=t,this},r.prototype.responseType=function(t){return this._responseType=t,this},r.prototype.serialize=function(t){return this._serializer=t,this},r.prototype.timeout=function(t){if(!t||"object"!=typeof t)return this._timeout=t,this._responseTimeout=0,this;for(var e in t)switch(e){case"deadline":this._timeout=t.deadline;break;case"response":this._responseTimeout=t.response;break;default:console.warn("Unknown timeout option",e)}return this},r.prototype.retry=function(t,e){return 0!==arguments.length&&!0!==t||(t=1),t<=0&&(t=0),this._maxRetries=t,this._retries=0,this._retryCallback=e,this};var s=["ECONNRESET","ETIMEDOUT","EADDRINFO","ESOCKETTIMEDOUT"];r.prototype._shouldRetry=function(t,e){if(!this._maxRetries||this._retries++>=this._maxRetries)return!1;if(this._retryCallback)try{var a=this._retryCallback(t,e);if(!0===a)return!0;if(!1===a)return!1}catch(t){console.error(t)}if(e&&e.status&&e.status>=500&&501!=e.status)return!0;if(t){if(t.code&&~s.indexOf(t.code))return!0;if(t.timeout&&"ECONNABORTED"==t.code)return!0;if(t.crossDomain)return!0}return!1},r.prototype._retry=function(){return this.clearTimeout(),this.req&&(this.req=null,this.req=this.request()),this._aborted=!1,this.timedout=!1,this._end()},r.prototype.then=function(t,e){if(!this._fullfilledPromise){var a=this;this._endCalled&&console.warn("Warning: superagent request was sent twice, because both .end() and .then() were called. Never call .end() if you use promises"),this._fullfilledPromise=new Promise(function(t,e){a.end(function(a,r){a?e(a):t(r)})})}return this._fullfilledPromise.then(t,e)},r.prototype.catch=function(t){return this.then(void 0,t)},r.prototype.use=function(t){return t(this),this},r.prototype.ok=function(t){if("function"!=typeof t)throw Error("Callback required");return this._okCallback=t,this},r.prototype._isResponseOK=function(t){return!!t&&(this._okCallback?this._okCallback(t):t.status>=200&&t.status<300)},r.prototype.get=function(t){return this._header[t.toLowerCase()]},r.prototype.getHeader=r.prototype.get,r.prototype.set=function(t,e){if(o(t)){for(var a in t)this.set(a,t[a]);return this}return this._header[t.toLowerCase()]=e,this.header[t]=e,this},r.prototype.unset=function(t){return delete this._header[t.toLowerCase()],delete this.header[t],this},r.prototype.field=function(t,e){if(null===t||void 0===t)throw new Error(".field(name, val) name can not be empty");if(this._data&&console.error(".field() can't be used if .send() is used. Please use only .send() or only .field() & .attach()"),o(t)){for(var a in t)this.field(a,t[a]);return this}if(Array.isArray(e)){for(var r in e)this.field(t,e[r]);return this}if(null===e||void 0===e)throw new Error(".field(name, val) val can not be empty");return"boolean"==typeof e&&(e=""+e),this._getFormData().append(t,e),this},r.prototype.abort=function(){return this._aborted?this:(this._aborted=!0,this.xhr&&this.xhr.abort(),this.req&&this.req.abort(),this.clearTimeout(),this.emit("abort"),this)},r.prototype._auth=function(t,e,a,r){switch(a.type){case"basic":this.set("Authorization","Basic "+r(t+":"+e));break;case"auto":this.username=t,this.password=e;break;case"bearer":this.set("Authorization","Bearer "+t)}return this},r.prototype.withCredentials=function(t){return void 0==t&&(t=!0),this._withCredentials=t,this},r.prototype.redirects=function(t){return this._maxRedirects=t,this},r.prototype.maxResponseSize=function(t){if("number"!=typeof t)throw TypeError("Invalid argument");return this._maxResponseSize=t,this},r.prototype.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}},r.prototype.send=function(t){var e=o(t),a=this._header["content-type"];if(this._formData&&console.error(".send() can't be used if .attach() or .field() is used. Please use only .send() or only .field() & .attach()"),e&&!this._data)Array.isArray(t)?this._data=[]:this._isHost(t)||(this._data={});else if(t&&this._data&&this._isHost(this._data))throw Error("Can't merge these send calls");if(e&&o(this._data))for(var r in t)this._data[r]=t[r];else"string"==typeof t?(a||this.type("form"),a=this._header["content-type"],this._data="application/x-www-form-urlencoded"==a?this._data?this._data+"&"+t:t:(this._data||"")+t):this._data=t;return!e||this._isHost(t)?this:(a||this.type("json"),this)},r.prototype.sortQuery=function(t){return this._sort=void 0===t||t,this},r.prototype._finalizeQueryString=function(){var t=this._query.join("&");if(t&&(this.url+=(this.url.indexOf("?")>=0?"&":"?")+t),this._query.length=0,this._sort){var e=this.url.indexOf("?");if(e>=0){var a=this.url.substring(e+1).split("&");"function"==typeof this._sort?a.sort(this._sort):a.sort(),this.url=this.url.substring(0,e)+"?"+a.join("&")}}},r.prototype._appendQueryString=function(){console.trace("Unsupported")},r.prototype._timeoutError=function(t,e,a){if(!this._aborted){var r=new Error(t+e+"ms exceeded");r.timeout=e,r.code="ECONNABORTED",r.errno=a,this.timedout=!0,this.abort(),this.callback(r)}},r.prototype._setTimeouts=function(){var t=this;this._timeout&&!this._timer&&(this._timer=setTimeout(function(){t._timeoutError("Timeout of ",t._timeout,"ETIME")},this._timeout)),this._responseTimeout&&!this._responseTimeoutTimer&&(this._responseTimeoutTimer=setTimeout(function(){t._timeoutError("Response timeout of ",t._responseTimeout,"ETIMEDOUT")},this._responseTimeout))}},function(t,e,a){"use strict";function r(t){if(t)return n(t)}function n(t){for(var e in r.prototype)t[e]=r.prototype[e];return t}var o=a(23);t.exports=r,r.prototype.get=function(t){return this.header[t.toLowerCase()]},r.prototype._setHeaderProperties=function(t){var e=t["content-type"]||"";this.type=o.type(e);var a=o.params(e);for(var r in a)this[r]=a[r];this.links={};try{t.link&&(this.links=o.parseLinks(t.link))}catch(t){}},r.prototype._setStatusProperties=function(t){var e=t/100|0;this.status=this.statusCode=t,this.statusType=e,this.info=1==e,this.ok=2==e,this.redirect=3==e,this.clientError=4==e,this.serverError=5==e,this.error=(4==e||5==e)&&this.toError(),this.created=201==t,this.accepted=202==t,this.noContent=204==t,this.badRequest=400==t,this.unauthorized=401==t,this.notAcceptable=406==t,this.forbidden=403==t,this.notFound=404==t,this.unprocessableEntity=422==t}},function(t,e,a){"use strict";e.type=function(t){return t.split(/ *; */).shift()},e.params=function(t){return t.split(/ *; */).reduce(function(t,e){var a=e.split(/ *= */),r=a.shift(),n=a.shift();return r&&n&&(t[r]=n),t},{})},e.parseLinks=function(t){return t.split(/ *, */).reduce(function(t,e){var a=e.split(/ *; */),r=a[0].slice(1,-1);return t[a[1].split(/ *= */)[1].slice(1,-1)]=r,t},{})},e.cleanHeader=function(t,e){return delete t["content-type"],delete t["content-length"],delete t["transfer-encoding"],delete t.host,e&&(delete t.authorization,delete t.cookie),t}},function(t,e){var a;a=function(){return this}();try{a=a||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(a=window)}t.exports=a}]);